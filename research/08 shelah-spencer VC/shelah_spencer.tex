\documentclass{amsart}

\usepackage{../AMC_style}	
\usepackage{../Research}
\usepackage{../Thm}

\usepackage{mathrsfs}
\usepackage{pgfpages} 
\usepackage{setspace}

\doublespacing
%% \usepackage[margin=.75in]{geometry}
%% \pgfpagesuselayout{2 on 1}

\renewcommand{\AA}{\mathscr A}
\newcommand{\BB}{\mathscr B}
\newcommand{\DD}{\mathscr D}
\newcommand{\II}{\mathscr I}
\newcommand{\GG}{\mathcal G}

\newcommand{\F}{\mathcal F}
\renewcommand{\LL}{\mathcal L}

\newcommand{\defn}{\underline}



\newcommand{\A}{\mathcal A}
\newcommand{\B}{\mathcal B}
\renewcommand{\C}{\mathcal C}
\newcommand{\D}{\mathcal D}
\renewcommand{\H}{\mathcal H}
\newcommand{\G}{\mathcal G}
\newcommand{\M}{\mathcal M}
\newcommand{\U}{\mathcal U}	
\newcommand{\X}{\mathcal X}
\newcommand{\Y}{\mathcal Y}

\newcommand{\K}{\boldface K_\alpha}
\renewcommand{\S}{S_\alpha}

\newcommand{\curly}[1]{\left\{#1\right\}}
\newcommand{\paren}[1]{\left(#1\right)}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\agl}[1]{\left\langle #1 \right\rangle}

\providecommand{\floor}[1]{\left \lfloor #1 \right \rfloor }

% \DeclareMathOperator{\dim}{dim}

\title{Some vc-density computations in Shelah-Spencer graphs}
\author{Anton Bobkov}
\email{bobkov@math.ucla.edu}

\begin{document}

\begin{abstract}
  We investigate vc-density in Shelah-Spencer graphs.
  We provide an upper bound on formula-by-formula basis and show that there isn't a uniform lower bound forcing the vc-function to be infinite.
\end{abstract}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

VC-density was studied in \cite{density} by Aschenbrenner, Dolich, Haskell, MacPherson, and Starchenko as a natural notion of dimension for NIP theories.
In a complete NIP theory $T$ we can define the vc-function

\begin{align*}
  \vc^T = \vc : \N \arr \R \cup \curly{\infty}
\end{align*}

where $\vc(n)$ measures the worst-case complexity of families of definable sets in an $n$-fold Cartesian power of the underlying set of a model of $T$
(see \ref{vc_fn_def} below for a precise definition of $\vc^T$).
The simplest possible behavior is $\vc(n) = n$ for all $n$. Theories with the property that $\vc(1) = 1$ are known to be dp-minimal, i.e., having the smallest possible dp-rank. It is not known whether there can be a dp-minimal theory which doesn't satisfy $\vc(n)=n$
(see \cite{density}, diagram on pg. 41).

In this paper, we investigate vc-density of definable sets in Shelah-Spencer graphs.
In our description of Shelah-Spencer graphs we follow closely the treatment in \cite{laskowski}.
A Shelah-Spencer graph is a limit of random structures $G(n, n^{-\alpha})$ for an irrational $\alpha \in (0,1)$.
$G(n, n^{-\alpha})$ is a random graph on $n$ vertices with edge probability $n^{-\alpha}$.

Our first result is that in Shelah-Spencer graphs
\begin{align*}
  \vc(n) = \infty
\end{align*}
which implies that they are not dp-minimal.
Our second result is providing an upper bound on a vc-density for a formula $\phi$
\begin{align*}
  \vc(\phi) \leq K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}    
\end{align*}
where $K(\phi), Y(\phi), \epsilon(\phi)$ are paramters easily computable from the quantifier free form of $\phi$.

Chapter 1 introduces basic facts about VC-dimension and vc-density.
More can be found in \cite{density}.
Chapter 2 summarizes notation and basic facts concerning Shelah-Spencer graphs.
We direct the reader to \cite{laskowski} for a more in-depth treatment.
In chapter 3 we introduce some measure of dimension for quantifier free formulas as well as proving some elementary facts about it.
Chapter 4 computes a lower bound for vc-density to demonstrate that $\vc(n) = \infty$.
Chapter 5 computes an upper bound for vc-density on a formula-by-formula basis.

% This struc is axiomatized by $S_\alpha$.
% Our ambient model is $\GG$.
% Notations we use are $\dim(\A), \dim(\A/\B), \A \leq \B$ as well as notions of $N$-strong substructure, minimal extension, chain minimal extension, minimal pair, and $N$-strong closure.

\input{../vc_intro.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Graph Combinatorics}

We denote a graph by $\A$, the set of its vertices by $v(\A)$, and the set of its edges by $e(\A)$.
Number of vertices of $\A$ will be denoted as $|\A|$.
For two subgraphs $\A, \B$ of a larger graph, the union $\A \cup \B$ denotes the graph induced on $v(\A) \cup v(\B)$.
\begin{Definition}
  Fix $\alpha \in (0,1)$, irrational.
  \begin{itemize}
  \item For a finite graph $\A$ let $\dim(\A) = |\A| - \alpha |e(\A)|$.
  \item For finite $\A,\B$ with $\A \subseteq \B$ define $\dim(\B/\A) = \dim(\B) - \dim(\A)$.
  \item We say that $\A \leq \B$ if $\A \subseteq \B$ and $\dim(\A'/\B) > 0$ for all $\A \subseteq \A' \subsetneq \B$.
  \item We say that finite $\A$ is \defn{positive} if for all $\A' \subseteq \A$ we have $\dim(\A') \geq 0$.
  \item We work in theory $S_\alpha$ axiomatized by
    \begin{itemize}
    \item Every finite substructure is positive.
    \item For a model $\GG$ given $\A \leq \B$ every embedding $f : \A \arr \GG$ extends to $g: \B \arr \GG$.
    \end{itemize}
  \item For $\A, \B$ positive, $(\A, \B)$ is called a \defn{minimal pair} if
    $\A \subseteq \B$, $\dim(\B/\A) < 0$ but $\dim(\A'/\A) \geq 0$ for all proper $\A \subseteq \A' \subsetneq \B$.
  \item $\agl{\A_i}_{i \leq m}$ is called a \defn{minimal chain} if $(\A_i, \A_i+1)$ is a minimal pair (for all $i < m$).
  \item For a positive $\A$ let $\dim_\A(\bar x)$ be the atomic diagram of $\A$. For positive $\A \subseteq \B$ let 
    \begin{align*}
      \Psi_{\A,\B}(\bar x) = \dim_\A(\bar x) \wedge \exists \bar y \; \dim_\B(\bar x, \bar y).
    \end{align*}
    Such formula is called a \defn{chain-minimal extension formula} if in addition we have that there is a minimal chain starting at 
    $\A$ and ending in $\B$.
    Denote such formulas as $\Psi_{\agl{\M_i}}$.
  \end{itemize}
\end{Definition}

\begin{Theorem} [5.6 in \cite{laskowski}]
  $S_\alpha$ admits quantifier elimination down to boolean combination of chain-minimal extension formulas.
\end{Theorem}

Fix $\GG$, an ambient structure satisfying $S_\alpha$.

\begin{Definition}
  A graph $S \subseteq \GG$ is called \defn{$N$-strong} if for any $S \subseteq T \subseteq \GG$ with $|T| - |S| \leq N$ we have $S \leq T$.
\end{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Basic Definitions and Lemmas}

Fix tuples $x = (x_1, \ldots x_n), y = (y_1, \ldots, y_m)$.
We refer to chain-minimal extension formulas as basic formulas.
Let $\phi_{\agl{\M_i}}(x, y)$ be a basic formula.

\begin{Definition}
  Define $\X$ to be the graph on vertices $\{x_i\}$ with edges as defined by $\phi_{\agl{\M_i}}$.
  Similarly define $\Y$.
  We define those abstractly, i.e. on a new set of vertices disjoint from $\GG$.
\end{Definition}

Note that $\X$, $\Y$ are positive as they are subgraphs of $\M_0$.
As usual $X, Y$ will refer to vertices of those graphs.

We restrict our attention to formulas that define no edges between $X$ and $Y$.

\begin{Note} \label{note_edges}
  We can handle edges between $x$ and $y$ as separate elements of the minimal chain extension.
\end{Note}

\begin{Definition} \label{def_basic}
  For a basic formula $\phi = \phi_{\agl{\M_i}_{i \leq k}}(x, y)$ let
  \begin{itemize}
  \item $\epsilon_i(\phi) = -\dim \paren{M_i/M_{i-1}}$.
  \item $\epsilon_L(\phi) = \sum_{[1..k]} \epsilon_i(\phi)$.
  \item $\epsilon_U(\phi) = \min_{[1..k]} \epsilon_i(\phi)$.
  \item Let $\Y'$ be a subgraph of $\Y$ induced by vertices of $\Y$ that are connected to $M_k - (X \cup Y)$.
  \item Let $Y(\phi) = \dim (\Y')$.
    In particular if $\Y = \Y'$ and $\Y$ is disconnected then $Y(\phi)$ is just the arity of the tuple $y$.
  \end{itemize}
\end{Definition}

We will require the following lemmas from \cite{laskowski}:

\begin{Lemma} \label{diamond} [See 2.3 in \cite{laskowski}]
  Let $A, B \subseteq D$.
  Then
  \begin{align*}
    \dim{A \cup B / A} \leq \dim{\B / A \cap B}.
  \end{align*}
  Moreover, 
  \begin{align*}
    \dim{A \cup B / A} = \dim{\B / A \cap B} - \alpha E,
  \end{align*}
  where $E$ is the number of edges connecting vertices of $A \cup B - A$ to vertices of $A - A \cap B$.
\end{Lemma}

\begin{Lemma} \label{las_min} [See 4.1 in \cite{laskowski}]
  Suppose $A$ is a positive graph, with at least $1/\alpha + 2$ vertices.
  Then for any $\epsilon > 0$ there exists a graph $B$ such that $(A, B)$ is a minimal pair with dimension $\leq \epsilon$.
  Moreover every vertex in $A$ is connected to a vertex in $B - A$.
\end{Lemma}

\begin{Lemma} \label{las_str} [See 4.4 in \cite{laskowski}]
  Suppose $A$ is a positive graph, and $G$ a model of $S_\alpha$.
  Then for any integer $S$ there exists an embedding $f \colon A \arr G$ such that $f(A)$ is $S$-strong in $G$.
\end{Lemma}
    
We conclude this section by stating a couple of technical lemmas that will be useful in our proofs later.

\begin{Lemma} \ref{minimal_over_set}
  Work in $\GG$.
  Suppose we have a set $B$ and a minimal pair $(A, M)$ with $A \subseteq B$ and $\dim(M/A) = -\epsilon$.
  Then either $M \subseteq B$ or $\dim((M \cup B)/B) < -\epsilon$.
\end{Lemma}

\begin{proof}
  By Lemma \ref{diamond}
  \begin{align*}
    \dim((M \cup B)/B) \leq \dim(M / (M \cap B))
  \end{align*}
  and as $A \subseteq M \cap B \subseteq M$
  \begin{align*}
    \dim (M/A) = \dim(M / (M \cap B)) + \dim((M \cap B) / A).
  \end{align*}
  In addition we are given $\dim (M/A) = -\epsilon$.
  If $M \not\subseteq B$ then $A \subseteq M \cap B \subsetneq M$ and by minimality $\dim((M \cap B) / A) > 0$.
  Combining the inequalities above we obtain the desired result:
  \begin{align*}
    \dim((M \cup B)/B) \leq \dim(M / (M \cap B)) = \dim (M/A) - \dim((M \cap B) / A) < -\epsilon.
  \end{align*}
\end{proof}



\begin{Lemma}	\label{chain_lemma}
  Suppose we have a set $B$ and a minimal chain $M_n$ with $M_0 \subseteq B$ and dimensions $-\epsilon_i$.
  Let $\epsilon$ be the minimal of $\epsilon_i$.
  Then either $M_n \subseteq B$ or $\dim((M_n \cup B)/B) < -\epsilon$.
\end{Lemma}


\begin{proof}
  Let $\bar M_i = M_i \cup B$. Then:
  \begin{align*}
    \dim(\bar M_n/B) = \dim(\bar M_n/\bar M_{n-1}) + \ldots + \dim(\bar M_2/\bar M_1) + \dim(\bar M_1/B).
  \end{align*}
  Either $M_n \subseteq B$ or at least one of the summands above is nonzero.
  Apply previous lemma.
\end{proof}

\begin{Lemma} \label{minimal_subset}
  Suppose we have a minimal pair $(A, M)$ with dimension $-\epsilon$.
  Suppose we have some $B \subseteq M$.
  Then $\dim B / (A \cap B) \geq -\epsilon$.
  Moreover if $B \cup A \neq M$ then $\dim B / (A \cap B) \geq 0$
\end{Lemma}

\begin{proof}
  We have $\dim (B \cup A / A) \leq \dim B / (A \cap B)$ by Lemma \ref{diamond}.
  As $A \subseteq B \cup A \subseteq M$ we have $\dim (B \cup A / A) \geq -\epsilon$ by minimality.
  Moreover, minimality implies that it is positive if $B \cup A \neq M$.
\end{proof}

\begin{Lemma} \label{chain_intersect}
  Suppose we have a minimal chain $M_n$ with dimensions $-\epsilon_i$.
  Let $\epsilon$ be the sum of all $\epsilon_i$.
  Suppose we have some $B$ with $B \subseteq M_n$.
  Then $\dim B / (M_0 \cap B) \geq -\epsilon$.
\end{Lemma}

\begin{proof}
  Let $B_i = B \cap M_i$.
  We have $\dim B_{i+1}/B_i \geq \dim M_{i+1}/M_i$ by the previous lemma.
  $\dim B / (M_0 \cap B) = \dim B_n / B_0 = \sum \dim B_{i+1}/B_i \geq -\epsilon$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Lower bound}

In this section restrict our attention to the following family of the basic formulas $\phi(x,y)$:
\begin{itemize}
%\item Graphs defined by $x,y$ are $\X, \Y$.
\item All formulas have $\Y' = \Y$ (see Definition \ref{def_basic}).
\item All formulas define no edges between $X$ and $Y$.
\item Minimal chain of $\phi(x,y)$ consists of one step, that is we only have minimal extension as opposed to a chain of minimal extensions.
\item Dimension of that minimal extension is smaller than $\alpha$.
\end{itemize}

We obtain a lower bound for the formulas that are boolean combinations of basic formulas written in disjunctive-conjunctive form.
First, extend our definition of $\epsilon$.

\begin{Definition}[Negation]
  If $\phi$ is a basic formula, then define
  \begin{align*}
    \epsilon_L(\neg \phi) &= \epsilon_L(\phi)
  \end{align*}
\end{Definition}

\begin{Definition}[Conjunction]
  Take a collection of formulas $\phi_i(x, y)$ where each $\phi_i$ is positive or negative basic formula.
  If both positive and negative formulas are present then $\epsilon_L(\phi) = \infty$.
  We don't have a lower bound for that case.
  If different formulas define $\X$ or $\Y$ differently then $\epsilon_L(\phi) = \infty$.
  In that case of the conflicting definitions would make the formula have no realizations.
  Otherwise
  \begin{align*}
    \epsilon_L(\bigwedge \phi_i) &= \sum \epsilon_L(\phi_i)
  \end{align*}
\end{Definition}

\begin{Definition} [Disjunction]
  Take a collection of formulas $\psi_i$ where each instance is a conjunction of positive and negative instances of basic formulas that agree on $\X$ and $\Y$.
  \begin{align*}
    \epsilon_L(\bigvee \psi_i) &= \min \epsilon_L(\psi_i).
  \end{align*}
\end{Definition}

\begin{Theorem}
  For a formula $\phi$ as above
  \begin{align*}
    \vc \phi \geq \floor{\frac{Y(\phi)}{\epsilon_L(\phi)}}
  \end{align*}
  where $Y(\phi)$ is $Y(\psi)$ for $\psi$ one the basic components of $\phi$ (all basic componenets agree on $\Y$).
\end{Theorem}

\begin{proof}
  First, work with a formula that is a conjunction of positive basic formulas $\psi = \bigwedge_{i \in I} \phi_i$.
  Then as we defined above
  \begin{align*}
    \epsilon_L(\psi) = \sum \epsilon_L(\phi_i)
  \end{align*}
  %Let $\phi$ be one of the basic formulas in $\psi$ with a chain $\agl{M_i}_{i \leq k}$.
  %Let $K_\phi = |M_k|$ i.e. the size of the extension.
  %Let $K$ be the largest such size among all $\phi_i$.
  Let $n_1$ be the largest natural number such that
  \begin{align*}
    n_1 \epsilon_L(\psi) < Y.
  \end{align*}
  Let $\epsilon'$ be the smallest value among $\epsilon_L(\phi_i)$ corresponding to the formula $\phi'$.
  Let $n_2$ be the largest natural number such that
  \begin{align*}
    n_1 \epsilon_L(\psi) + n_2 \epsilon' < Y.
  \end{align*}

  Fix some $N > n$.
  Let $a_j$ be a graph isomorphic to $\X$ for each $1 \leq j \leq N$.
  Let $A = \bigsqcup_{1 \leq j \leq N} a_j$.
  Let $S = ??$.

  By Lemma \ref{las_str} $A$ can be embedded into $\GG$ as a $S$-strong graph. 
  Abusing notation, we identify $A$ with this embedding.
  Thus we have $A \subseteq \GG$, $S$-strong. 

  Let $J_1$ be the index set enumerating first $n_1$ natural numbers,
  $J_2$ enumerating the following $n_2$ numbers.%, $J_3$ -- the following $n_3$ numbers.
  Let $b$ be a graph isomorphic to $\Y$.
  For each $i \in I, j \in J_1$ let $W_{ij}$ be a witness of $\phi_i(a_j, b)$.
  For each $j \in J_1$ let $W_j$ be a union of $\curly{W_{ij}}_{i \in I}$ disjoint over $a_j, b$.
  For each $j \in J_2$ let $W_{j}$ be a witness of $\phi'(a_j, b)$.
  Let $W_1$ be a union of
  \begin{align*}
    \curly{W_j}_{j \in J_1 \cup J_2}
  \end{align*}
  disjoint over $b$.
  Let $W$ be a union of $W_1$ and $A$ disjoint over $\curly{a_j}_{j \in J_1 \cup J_2}$.
  %Additionally, modify $W$ to include one edge from a vertex in $a_j$ to a vertex in $b$ for each $j \in J_3$. 

  \begin{Claim}
    $A \leq W$.
  \end{Claim}
  \begin{proof}
    Consider some $A \subsetneq B \subseteq W$.
    We need to show $\dim (B/A) > 0$
    Let $\bar A = A \cup b$.
    We have
    \begin{align*}
      \dim(B/A) = \dim(B/ B \cap \bar A) + \dim(B \cap \bar A / A).
    \end{align*}
    Let $B_{ij} = B \cap W_{ij} \subseteq W_{ij}$.
    Let $B_{j} = B \cap W_{j} \subseteq W_{j}$.
    To unify indices, relabel all the graphs above as $\curly{B_k}_{k \in K}$.
    %We have $B_k$'s are disjoint over $\bar A$ and their union is all of $B$.
    By construction of $W$ we have
    \begin{align*}
      \dim(B/ B \cap \bar A) = \sum_{k \in K} \dim(B_k/ B_k \cap \bar A)
    \end{align*}
    Fix $k$.
    We have $B_k \subset W_k$, where $W_k$ is a minimal extension over $M^k_0 = a \cup b$ for some $a \in A$.
    We have $\dim(B_k / B_k \cap \bar A) = \dim(B_k / a \cup (B \cap b))$.
    Let $\epsilon_k$ be the dimension of this minimal extension.

    Case 1: $B \cap b = b$.
    Then $M_0^k \subseteq B_k \subseteq W_k$ and $\dim(B_k / a \cup (B \cap b)) = \dim (B_k/M_0^k)$.
    By minimality of $(M_0^k, B_k)$ we have $\dim (B_k/M_0^k) \geq -\epsilon_k$.
    Thus
    \begin{align*}
      \dim(B/ B \cap \bar A) \geq - \sum_{k \in K} \epsilon_k = -\paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'}.
    \end{align*}
    In addition
    \begin{align*}
      \dim(B \cap \bar A / A) = \dim (b) = Y(\psi).
    \end{align*}
    Combining the two, we get
    \begin{align*}
      \dim(B/A) \geq Y(\psi) - \paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'},
    \end{align*}
    which is positive by construction of $n_1, n_2$ as needed.
    
    Case 2: $B \cap b \subsetneq b$.
    \begin{Claim}
    \begin{align*}
      \dim(B_k / B_k \cap \bar A) > 0
    \end{align*}
    \end{Claim}
    \begin{proof}
      Recall that $\dim(B_k / B_k \cap \bar A) = \dim(B_k / a \cup (B \cap b))$.
      First, suppose that $B_k \cup M_0^k \neq W_k$.
      Then by Lemma \ref{minimal_subset} we get the required inequality.
      Thus we may assume that $B_k \cup M_0^k = W_k$.
      By Lemma \ref{diamond} we have
      \begin{align*}
        \dim{B_k \cup M_0^k / M_0^k} = \dim{B_k / B_k \cap M_0^k} - \alpha E,
      \end{align*}
      where $E$ is the number of edges connecting vertices of $B_k \cup M_0^k - M_0^k$ to vertices of $M_0^k - B_k \cap M_0^k$.
      Noting that $B_k \cup M_0^k = W_k$, $\dim{W_k / M_0^k} = -\epsilon_k$, and $B_k \cap M_0^k = a \cup (B \cap b)$
      we may rewrite the equality above as
      \begin{align*}
        \dim{B_k / a \cup (B \cap b)} = \alpha E - \epsilon,
      \end{align*}
      and $E$ is the number of edges connecting vertices of $W_k - M_0^k$ to vertices of $M_0^k - a \cup (B \cap b)$.
      as $\Y = \Y'$ and $B \cap b \subsetneq b$ we must have $E > 0$.
      But then as $\alpha > \epsilon$ we have $\dim{B_k / a \cup (B \cap b)} > 0$ as needed.
    \end{proof}
    Now, recall that
    \begin{align*}
      \dim(B/A) = \dim(B \cap \bar A / A) + \sum_{k \in K} \dim(B_k/ B_k \cap \bar A)
    \end{align*}
    By the claim above each of $\dim(B_k/ B_k \cap \bar A) > 0$, thus
    \begin{align*}
      \dim(B/A) > \dim(B \cap \bar A / A)
    \end{align*}
    In addition
    \begin{align*}
      \dim(B \cap \bar A / A) = \dim (b \cap B) \geq 0,
    \end{align*}
    as $b$ is postive.
    Thus $\dim (B/A) > 0$ as needed.
  \end{proof}

  As $A \leq W$ and $A \subseteq \GG$, we can embed $W$ into $\GG$ over $A$.
  Abusing notation again, we identify $W$ with its embedding $A \leq W \subseteq \GG$.
  In particular, now we have $b \in \GG$.
  Also note that
  \begin{align*}
    \dim(W/A) &= Y(\psi) - \paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'} \\
    |W| - |A| &\leq |b| + (n_1 + n_2) \sum_{i \in I} S_i
  \end{align*}

  \begin{Lemma}
    \begin{align*}
      \curly{a_j}_{j \in J_1} \subseteq \psi(A, b) \subseteq \curly{a_j}_{j \in J_1 \cup J_2}
    \end{align*}
  \end{Lemma}
  \begin{proof}
    First inclusion $\curly{a_j}_{j \in J_1} \subseteq \psi(A, b)$ is immediate from construction of $W$,
    as $W_{ij}$ witnesses that $\phi_i(a_j, b)$ holds.
    For the second inclusion, suppose that there is $a \in A - \curly{a_j}_{j \in J_1 \cup J_2}$ such that $\psi(a,b)$ holds.
    Let $W' \subseteq \GG$ be a witness of $\phi_1(a,b)$.
    First, note that the case $W' \subseteq W$ is impossible
    as there are no edges between $a$ and $W - a$, but there are edges between $a$ and $W' - a$.
    Thus assume $W' \not\subset W$.
    As $(a \cup b, W')$ is minimal, by Lemma \ref{minimal_over_set} we have $\dim (W' \cup W / W) < -\epsilon_1$.
    \begin{align*}
      \dim(W' \cup W / A) = \dim (W' \cup W / W) + \dim(W/A) < Y(\psi) - \paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'} - \epsilon_1,
    \end{align*}
    which is negative by construction of $n_1, n_2$.
    Thus $A \not\leq W \cup W'$, as then it would have a positive dimension.
    Additionally,
    \begin{align*}
      |W' \cup W| - |A| \leq |W' - W| + |W| - |A| \leq S_1 + |b| + (n_1 + n_2) \sum_{i \in I} S_i \leq S,
    \end{align*}
    but then this contradicts that $A$ is $S$-strong, as then we would have $A \leq W \cup W'$.
  \end{proof}

  In the construction of $W$ we could have chosen indices $J_1, J_2$ arbitrarily, instead of at the beginning of $A$.
  In particular, say we let $J_2$ to be the last $n_2$ indices of $J$ and
  $J_1$ an arbitrary $n_1$-element subset of the first $N$ elements of $J$.
  Each of those choices would then yield a different trace $\psi(A, b)$ by the lemma above.
  Thus $\psi(A, M^{|y|}) \geq {N \choose n_1}$ and therefore $\vc(\psi) \geq n_1$.
  By definition of $n_1$ we have $n_1 = \floor{\frac{Y(\psi)}{\epsilon_L(\psi)}}$, so this proves the theorem for $\psi$.
 
  Now consider a formula which is a conjunction consisting of negative basic formulas
  \begin{align*}
    \psi = \bigwedge_{i \in I} \neg \phi_i
  \end{align*}
  Let
  \begin{align*}
    \bar \psi = \bigwedge_{i \in I} \phi_i
  \end{align*}

  Do the construction above for $\bar \psi$ and suppose its trace is $X \subseteq A$ for some $b$.
  Then over $b$ the same construction gives trace $(A - X)$ for $\psi$. Thus we get as many traces as above, and the same bound.
  
  Finally consider a formula which is a disjunction of formulas considered above.
  \begin{align*}
    \theta = \bigvee{k \in K} \psi_k
  \end{align*}
  Choose the one with the smallest $\epsilon_L$, say $\psi_k$, and repeat the construction above for $\psi_k$.
  Any trace we obtain is automatically a trace for $\theta$, and thus we get as many traces as above, and the same bound.
\end{proof}

\begin{Corollary}
  VC-function is infinite in Shelah-Spencer random graphs:
  \begin{align*}
    \vc(n) = \infty.
  \end{align*}
\end{Corollary}

\begin{proof}
  Let $A$ be a graph consisting of $1/\alpha + 2 + n$ disconnected vertices.
  Fix $\epsilon > 0$.
  By Lemma \ref{las_min}, there exists $B$ such that $(A, B)$ is minimal with dimension $\leq \epsilon$.
  Consider a basic formula $\psi_{A, B}(x, y)$ where $|x| = 1/\alpha + 2$ and $|y| = n$.
  Then by the theorem above $\vc (\psi_{A,B}) \geq \frac{n}{\epsilon}$.
  As $\epsilon$ was arbitrary, this finishes the proof.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Upper bound}

We bound the number of types of some finite collection of formulas $\Psi(\vec x, \vec y) = \curly{\phi_i(\vec x, \vec y)}_{i\in I}$ over a parameter set $B$ of size $N$,
where $\phi_i$ is a basic formula.

Fix a formula $\phi$ from our collection.
Suppose it defines a minimal chain extension over $\{x, y\}$. 
Record the size of that extension as $K(\phi)$ and its total dimension $\epsilon(\phi) = \epsilon_U(\phi)$.
Define dimension of that formula $D(\phi) = |\vec y| \frac{K(\phi)}{\epsilon(\phi)}$
Define dimension of the entire collection as $D(\Psi) = \max_{i \in I} D(\phi_i)$

In general we have parameter set $B \subseteq \GG^{|y|}$, however without loss of generality we may work with
a parameter set $B^{|y|}$, with $B \subseteq \GG$.

Let $S = \floor{D(\Psi)}$.

For our proof to work we also need $B$ to be $S$-strong.
We can achieve this by taking (the unique) $S$-strong closure of $B$.
If size of $B$ is $N$ then the size of its closure is $O(N)$.	%elaborate
So without loss of generality we can assume that $B$ is $S$-strong.

\begin{Definition}
  A \defn{witness} of $a$ is a union of realizations of the existential formulas $\phi_i(a, b)$ for all $i, b$ so that the formula holds.
\end{Definition}

\begin{Definition}
  For sets $C, B$ define the boundary of $C$ over $B$
  \begin{align*}
    \partial(C, B) = \curly{b \in B \mid \text{there is an edge between $b$ and element of $C - B$}}
  \end{align*}
\end{Definition}

\begin{Definition}
  For each $a$ pick some $\bar M_a$ to be its witness.
  Define two quantities
  \begin{itemize}
  \item $\partial_a$ is the boundary $\partial(\bar M_a, B \cup a)$
  \item Suppose $G_1, G_2$ are some subgraphs of our model and $a_1 \subseteq G_1, a_2 \subseteq G_2$ finite tuples of vertices.
    Call $f \colon (G_1, a_1) \arr (G_2, a_2)$ a $\partial$-isomorphism if it is a graph isomorphism,
    $f$ and $f^{-1}$ are constant on $B$, and
    $f(a_1) = a_2$.
  \item Define $\II_a$ as the $\partial$-isomorphism class of $(\bar M_a, a)$.
  \end{itemize}
\end{Definition}

\begin{Lemma} \label {bound_trace}
  If $\II_{a_1} = \II_{a_2}$ then $a_1, a_2$ have the same $\Psi$-type over $B$.
\end{Lemma}

\begin{proof}
  Fix a $\partial$-isomorphism $f \colon (\bar M_{a_1}, a_1) \arr (\bar M_{a_1}, a_2)$.
  Suppose we have $\phi(a_1, b)$ for some $b \in B$.
  Pick witness of this existential formula $M_1 \subseteq \bar M_{a_1}$.
  Then $f(M_1)$ is a witness for  $\phi(a_2, b)$.
\end{proof}

Thus to bound the number of traces it is sufficient to bound the number of possibilities for $\II_a$.

\begin{Theorem} \label{main_bound}
  \begin{align*}
    |\partial_a| &\leq D(\Psi) \\ 
    |\bar M_b - \bar A| &\leq D(\Psi)
  \end{align*}
\end{Theorem}

\begin{Corollary}
  \begin{align*}
    \vc(\phi) \leq K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}
  \end{align*}
\end{Corollary}

\begin{proof}
  We count possible $\partial$-isomorphism classes $\II_b$.
  Let $W = K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}$.
  If the parameter set $A$ is of size $N$ then there are $N \choose W$ choices for boundary $\partial_b$.
  On top of the boundary there are at most $W$ extra vertices and $(2W)^2$ extra edges.
  Thus there are at most
  \begin{align*}
    W \cdot 2^{(2W)^2}
  \end{align*}
  configurations up to a graph isomorphism.
  In total this gives us 
  \begin{align*}
    {N \choose W} \cdot W \cdot 2^{(2W)^2} = O(N^W)
  \end{align*}
  options for $\partial$-isomorphism classes.
  By Lemma \ref{bound_trace} there are at most $O(N^W)$ many traces, giving the required bound.
\end{proof}

\begin{proof} \textit{(of Theorem \ref{main_bound})}
  Fix some $b$-trace $A_b$. Enumerate $A_b = \{a_1, \ldots, a_I\}$.

  Let $M_i / \{a_i, b\}$ be a witness of $\phi(a_i, b)$ for each $i \leq I$.
  Let $\bar M_i = \bigcup_{j < i} M_j$.
  Let $\bar M = \bigcup M_i$, a witness of $A_b$
  
  \begin{Claim}
    \begin{align*}
      &\abs{\partial(M_i M, \bar A) - \partial(M, \bar A)} \leq |M_i| = K(\phi)\\
      &\dim(M_i M \bar A / M \bar A) > -\epsilon(\phi)
    \end{align*}
  \end{Claim}
  
  \begin{Definition}
    $(j-1, j)$ is called a \defn{jump} if some of the following conditions happen
    \begin{itemize}
    \item New vertices are added outside of $\bar A$ i.e.
      \begin{align*}
        \bar M_j - \bar A \neq \bar M_{j-1} - \bar A
      \end{align*}
    \item New vertices are added to the boundary, i.e.
      \begin{align*}
        \partial(\bar M_j, \bar A) \neq \partial(\bar M_{j-1}, \bar A)
      \end{align*}
    \end{itemize}
  \end{Definition}

  \begin{Definition}
    We now let $m_i$ count all jumps below $i$
    % Let $d_i = \dim(\bar M_i/A)$.
    \begin{align*}
      m_i = \abs{\curly{j < i \mid (j-1, j) \text{ is a jump}}}
    \end{align*}
  \end{Definition}

  \begin{Lemma} \label{ub_lemma}
    \begin{align*}
      \dim(\bar M_i / \bar A) &\leq -m_i \cdot \epsilon(\phi) \\
      |\partial(\bar M_i, \bar A)| &\leq m_i \cdot K(\phi) \\
      |\bar M_j - \bar A| &\leq m_i \cdot K(\phi)
    \end{align*}
  \end{Lemma}

  \begin{proof} \textit{(of Lemma \ref{ub_lemma})}
    Proceed by induction.
    Second and third propositions are clear.
    For the first proposition base case is clear.
    
    Induction step.
    Suppose $\bar M_j \cap (A \cup b) = \bar M_{j+1}$ and $\partial(\bar M_j, A) = \partial(\bar M_{j+1}, A)$.
    Then $m_i = m_{i+1}$ and the quantities don't change.
    Thus assume at least one of these equalities fails.
    
    Apply Lemma \ref{chain_lemma} to $\bar M_j \cup (A \cup b)$ and $(M_{j+1}, a_{j+1}b)$.
    There are two options
    
    \begin{itemize}
    \item $\dim(\bar M_{j+1} \cup (A \cup b) / \bar M_i \cup (A \cup b)) \leq -\epsilon_U$.
      This implies the proposition.
    \item $M_{j+1} \subseteq \bar M_j \cup (A \cup b)$.
      Then by our assumption it has to be $\partial(\bar M_j, A) \neq \partial(\bar M_{j+1}, A)$.
      There are edges between $M_{j+1} \cap (\partial(\bar M_{j+1}, A) - \partial(\bar M_j, A))$ so they contribute some negative dimension $\leq \epsilon_U$.
    \end{itemize}
    This ends the proof for Lemma \ref{ub_lemma}.
  \end{proof}
  \textit{(Proof of Theorem \ref{main_bound} continued)}
  First part of lemma \ref{ub_lemma} implies that we have $\dim(\bar M / \bar A) \leq -m_I \cdot \epsilon(\phi)$.
  The requirement of $A$ to be $S$-strong forces
  \begin{align*}
    m_I \cdot \epsilon(\phi) &< Y(\phi) \\
    m_I  &< \frac{Y(\phi)}{\epsilon(\phi)} \\
  \end{align*}
  % Let $W = \frac{K(\phi)Y(\phi)}{\epsilon(\phi)}$
  Applying the rest of \ref{ub_lemma} gives us
  \begin{align*}
    |\partial(\bar M, A)| &\leq m_I \cdot K(\phi) \leq \frac{K(\phi)Y(\phi)}{\epsilon(\phi)} \\
    |\bar M \cap A| &\leq m_I \cdot K(\phi) \leq \frac{K(\phi)Y(\phi)}{\epsilon(\phi)}
  \end{align*}
  as needed.
  This ends the proof for Theorem \ref{main_bound}.
\end{proof}

So far we have computed an upper bound for a single basic formula $\phi$.

To bound an arbitrary formula, write it as a boolean combination of basic formulas $\phi_i$ (via quantifier elimination)
It suffices to bound vc-density for collection of formulas $\{\phi_i\}$ to obtain a bound for the original formula.

In general work with a collection of basic formulas $\{\phi_i\}_{i \in I}$.
The proof generalizes in a straightforward manner.
Instead of $A^{|x|}$ we now work with $A^{|x|} \times I$ separating traces of different formulas.
Formula with the largest quantity $Y(\phi)\frac{K(\phi)}{\epsilon(\phi)}$ contributes the most to the vc-density.
Thus we have
\begin{align*}
  \Phi &= \{\phi_i\}_{i \in I} \\
  \vc(\Phi) &\leq   \max_{i \in I} Y(\phi_i) \frac{K(\phi_i)}{\epsilon_{\phi_i}}
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\begin{thebibliography}{9}

\bibitem{density}
  M. Aschenbrenner, A. Dolich, D. Haskell, D. Macpherson, S. Starchenko,
  \textit{Vapnik-Chervonenkis density in some theories without the independence property}, I,
  Trans. Amer. Math. Soc. 368 (2016), 5889-5949
  
\bibitem{laskowski}
  Michael C. Laskowski, \textit{A simpler axiomatization of the Shelah-Spencer almost sure theories},
  Israel J. Math. \textbf{161} (2007), 157–186. MR MR2350161	

\bibitem{ash7}
  P. Assouad, \textit{Densit´e et dimension}, Ann. Inst. Fourier (Grenoble) 33 (1983), no. 3, 233-282.
\bibitem{ash8}
  P. Assouad, \textit{Observations sur les classes de Vapnik-Cervonenkis et la dimension combinatoire de Blei},
  in: Seminaire d’Analyse Harmonique, 1983-1984, pp. 92-112, Publications Math´ematiques
  d’Orsay, vol. 85-2, Universit´e de Paris-Sud, D´epartement de Math´ematiques, Orsay, 1985.
\bibitem{sauer}
  N. Sauer, \textit{On the density of families of sets}, J. Combinatorial Theory Ser. A 13 (1972), 145-147.
\bibitem{shelah}
  S. Shelah, \textit{A combinatorial problem; stability and order for models and theories in infinitary languages},
  Pacific J. Math. 41 (1972), 247-261.

\end{thebibliography}

\end{document}

