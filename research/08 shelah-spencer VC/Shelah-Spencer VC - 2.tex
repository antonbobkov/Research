\documentclass{amsart}

\usepackage{../AMC_style}	
\usepackage{../Research}
\usepackage{../Thm}

\usepackage{mathrsfs}



\renewcommand{\AA}{\mathscr A}

  \newcommand{\A}{\mathcal A}
  \newcommand{\B}{\mathcal B}
\renewcommand{\C}{\mathcal C}
  \newcommand{\D}{\mathcal D}
\renewcommand{\H}{\mathcal H}
  \newcommand{\G}{\mathcal G}
  \newcommand{\M}{\mathcal M}

  \newcommand{\U}{\mathcal U}	

  \newcommand{\K}{\boldface K_\alpha}
\renewcommand{\S}{S_\alpha}

\newcommand{\curly}[1]{\left\{#1\right\}}
\newcommand{\paren}[1]{\left(#1\right)}
\newcommand{\abs}[1]{\left|#1\right|}

\providecommand{\floor}[1]{\left \lfloor #1 \right \rfloor }

%\DeclareMathOperator{\dim}{dim}

\title{Some vc-density computations in Shelah-Spencer graphs}
\author{Anton Bobkov}
\email{bobkov@math.ucla.edu}

\begin{document}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definitions}

\begin{Definition}
	A formula $\phi(x, y)$ is called \emph{basic} if
	\begin{itemize}
		\item $\phi(x, y)$ is a minimal chain extension $\curly{M_i}_{i \in [0..k]}$ with $M_0 = \{x, y\}$
		\item $\phi(x, y)$ determines edges and non-edges on $\curly{x, y}$.
		\item there are no edges between $x$ and $y$.
		%\item there are no edges between $x$.
		%\item graph $y$ is positive
		\item all elements of $y$ that are connected to $M_k - \{x,y\}$. (see note \ref{note_special})
	\end{itemize}
\end{Definition}

% issue: multiple possible chain decompositions?

% address strength

% address edges between x and y

\begin{Note} \label{note_special}
	We add the final condition to simplify our analysis. Similar techniques can be used to acquire bounds on formulas not subject to that condition.
\end{Note}

\begin{Definition}
	For a basic formula $\phi(x, y)$ let
	\begin{itemize}
		\item $\dim \paren{M_i/M_{i-1}} = -\epsilon_i(\phi)$.
		\item if $x$ or $y$ aren't positive, then $\epsilon_L(\phi) = \epsilon_U(\phi) = \infty$. Otherwise
		\item $\epsilon_L(\phi) = \sum_{[1..k]} \epsilon_i(\phi)$.
		\item $\epsilon_U(\phi) = \min_{[1..k]} \epsilon_i(\phi)$.
		\item Let $Y(\phi) = \dim (y)$ considering $y$ as a graph.
		In particular if $\{y\}$ are disconnected then $Y = |y|$.
	\end{itemize}
\end{Definition}

We work with formulas that are boolean combinations of basic formulas written in disjunctive-conjunctive form.
Define dimensions for those inductively.

\begin{Definition}[Negation]
	If $\phi$ is a basic formula, then (with $* = \{L, U\}$)
	\begin{align*}
		\epsilon_*(\neg \phi) &= \epsilon_*(\phi)
	\end{align*}
\end{Definition}

\begin{Definition}[Conjunction]
	Take a collection of formulas $\phi_i(x, y)$ where each $\phi_i$ is positive or negative basic formula.
	If both positive and negative formulas are present then $\epsilon_L(\phi) = \epsilon_U(\phi) = \infty$.
	If different formulas define graphs for $x$ differently then $\epsilon_L(\phi) = \epsilon_U(\phi) = \infty$.
	Otherwise
	\begin{align*}
		\epsilon_L(\bigwedge \phi_i) &= \sum \epsilon_L(\phi_i) \\
		\epsilon_U(\bigwedge \phi_i) &= \min \epsilon_U(\phi_i)
	\end{align*}
\end{Definition}

\begin{Definition} [Disjunction]
	Take a collection of formulas $\psi_i$ where each instance is a conjunction of positive and negative instances of basic formulas.
	Then (with $* = \{L, U\}$)
	\begin{align*}
		\epsilon_*(\bigvee \psi_i) &= \min \epsilon_*(\psi_i)
	\end{align*}
\end{Definition}

%\begin{Definition}
%\begin{align*}
	%\epsilon_L(\neg \phi) &= \epsilon_L(\phi) \\
	%\epsilon_U(\neg \phi) &= \epsilon_U(\phi) \\
	%\epsilon_L(\phi \wedge \psi) &= \epsilon_L(\phi) + \epsilon_L(\psi) \\
	%\epsilon_U(\phi \wedge \psi) &= \min(\epsilon_U(\phi), \epsilon_U(\psi)) \\
	%\epsilon_L(\phi \vee \psi) &= \min(\epsilon_L(\phi), \epsilon_L(\psi)) \\
	%\epsilon_U(\phi \vee \psi) &= \min(\epsilon_U(\phi), \epsilon_U(\psi)) 
%\end{align*}
%\end{Definition}

Some of our results only apply to a special family of parameter sets
\begin{Definition}
	\begin{align*}
		\AA = \curly{A \subset \U^{y} \mid \text{finite, disconnected, strongly embedded}}
	\end{align*}
\end{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Lower bound}

Here we show that for a formula $\phi$ we have 
\begin{align*}
	\vc \phi \geq \floor{\frac{Y}{\epsilon_L}}
\end{align*}

First we discuss cases with $\epsilon_L$ infinite.

If $x$ or $y$ are not positive they don't have realizations.

Consider a formula in conjunctive-disjunctive form. Look at individual conjunctive components. If there are positive and negative components, then the formula has no realizations over sufficiently large parameter sets, as will be shown later. So we only consider only components where all the formulas are positive or all the formulas are negative.

Also each basic formula has to describe graph of $x$.
If there are two formulas in the conjunct that disagree on that, then there are no realizations of the conjunction.
We ignore those components as well. 

Given a disjunction of formulas, choose one with the smallest $\epsilon_L$.
Assume that our formula is conjunction of positive instances of basic formulas and we will consider the negative case later.

\begin{align*}
	\psi = \bigwedge \phi_j \in \Phi
\end{align*}

\begin{align*}
	\epsilon_L(\psi) = \sum \phi_j \in \Phi
\end{align*}

Let $n$ be the integer such that $n \epsilon_L(\psi) < Y$ and $(n+1) \epsilon_L(\psi) > Y$.

Take an abstract realization of $y$, and label it by $b$.


Pick parameter set 

\begin{align*}
	A = \bigcup_{i<N} b_i
\end{align*}

a disjoint union where each $b_i$ is an ordered tuple of size $|x|$ connected according to $\psi$.
We also require $A$ to be strong.

Fix $n$ arbitrary elements out of $b_i$, label them $a_i$.

Fix an individual formula $\phi \in \Phi$, with minimal sequence $M_i$.

Abstractly adjoin $M_i/\curly{a_i, b} = M/\curly{x,y}$ for each $i$.
Let $\bar M_\phi = \bigcup M_i$ (disjointly).

We can join those for all $\phi \in \Phi$.
Let $\bar M = \bigcup M_\phi$ (disjointly).

\begin{Claim}
	$(A \cap \bar M) \leq \bar M$.
\end{Claim}
\begin{proof}
	It's total dimension is $Y - n\epsilon_L(\psi) > 0$ and all subextensions are positive as well.
\end{proof}

Thus a copy of $\bar M$ can be embedded over $A$ into our ambient model.
Our choice of $b_i$ was arbitrary, so we get ${N \choose n}$ choices out of $N|x|$ many elements.
Thus we have $O(|A|^n)$ many traces.

\begin{Lemma}
	There are arbitrarily large sets with properties of $A$.
\end{Lemma}

This shows

\begin{align*}
	\vc \phi \geq n = \floor{\frac{Y}{\epsilon_L}}
\end{align*}

Now consider the case when the chose conjunction consists of negative basic formulas
\begin{align*}
	\psi = \bigwedge \neg \phi_i
\end{align*}
Let
\begin{align*}
	\bar \psi = \bigwedge \phi_i
\end{align*}

Do the construction above for $\bar \psi$ and suppose its trace is $X \subset A$ for some $b$.
Then over $b$ the same construction gives trace $(A - X)$ for $\psi$. Thus we get as many traces.

\begin{Claim}
	We can find a minimal extension $M / \{x, y\}$ with arbitrarily small dimension.
\end{Claim}

This shows that vc function is infinite in Shelah-Spencer random graphs.

\begin{align*}
	\vc(n) = \infty
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Upper bound}

%Let $n$ be the integer such that $n \epsilon_U < Y$ and $(n+1) \epsilon_U > Y$.

%Consider a formula which is a conjunction of positive basic formulas.

Work with a parameter set $A^{|x|}$, with $A \subset M$.

% In general we have A \subset M^{|x|}

Pick a trace of $\phi(x,y)$ on $A$ by a parameter $b$.
Record $A \cap b$.

Let
\begin{align*}
	A_b = \curly{a \in A^{|x|} \mid \phi(a, b)}
\end{align*}

Enumerate $A_b = \curly{a_i}_{i \leq I}$.
This is a trace of $\phi$ on $A$.

Let $M_i / \{a_i, b\}$ be a witness of $\phi(a_i, b)$ for each $i \leq I$.
Let $\bar M = \bigcup M_i$.
Consider $\bar M / A$.

\begin{Definition}
	Define the boundary of $C$ over $A \cup b$
	\begin{align*}
		\partial(C, A \cup b) = \curly{a \in (A \cup b) \mid \text{there is an edge between $a$ and element of $D - (A \cup b)$}}
	\end{align*}
\end{Definition}

Let $\bar M_i = \bigcup_{j < i} M_j$.

\begin{Definition}
	$(j-1, j)$ is called a \emph{jump} if some of the following conditions happen
	\begin{itemize}
		\item New vertices are added outside of $A$ i.e.
			\begin{align*}
				\bar M_j - A \neq \bar M_{j-1} - A
			\end{align*}
		\item New vertices are added to the boundary, i.e.
			\begin{align*}
				\partial(\bar M_j, A) \neq \partial(\bar M_{j-1}, A)
			\end{align*}
	\end{itemize}
\end{Definition}

\begin{Definition}
	We now let $m_i$ count all jumps below $i$
	%Let $d_i = \dim(\bar M_i/A)$.
	\begin{align*}
		m_i = \abs{\curly{j < i \mid (j-1, j) \text{ is a jump}}}
	\end{align*}
\end{Definition}

\begin{Lemma}
	\begin{align*}
		\dim(\bar M_i / (A \cup b)) &\leq -m_i \cdot \epsilon_U \\
		|\partial(\bar M_i, (A \cup b))| &\leq m_i \cdot |M| \\
		|\bar M_j - (A \cup b)| &\leq m_i \cdot |M|
	\end{align*}
\end{Lemma}

\begin{proof}
	Proceed by induction.
	Second and third propositions are clear.
	For the first proposition base case is clear.
	
	Induction step.
	Suppose $\bar M_j \cap A = \bar M_{j+1}$ and $\partial(\bar M_j, A) = \partial(\bar M_{j+1}, A)$.
	Then $m_i = m_{i+1}$ and the quantities don't change.
	Thus assume at least one of these equalities fails.
	
	Apply Lemma \ref{chain_lemma} to $\bar M_j \cup A$ and $(M_{j+1}, a_{j+1},b)$.
	There are two options
	
	\begin{itemize}
		\item $\dim(\bar M_{j+1} \cup A / \bar M_i \cup A) \leq -\epsilon_U$.
		This implies the proposition.
		\item $M_{j+1} \subset \bar M_j \cup A$.
		Then by our assumption it has to be $\partial(\bar M_j, A) \neq \partial(\bar M_{j+1}, A)$.
		There are edges between $M_{j+1} \cap (\partial(\bar M_{j+1}, A) - \partial(\bar M_j, A))$ so they contribute some negative dimension $\leq \epsilon_U$.
	\end{itemize}
\end{proof}

Let $m = m_I$.
Thus we have $\dim(\bar M / (A \cup b)) = \leq -m \cdot \epsilon_U $.
Thus as $A$ is strong we need $I \cdot \epsilon_U < Y$.
Let $W = \frac{|M|Y}{\epsilon_U}$.
\begin{align*}
	|\partial(\bar M, A)| &\leq m \cdot |M| \leq W \\
	|\bar M \cap A| &\leq m \cdot |M| \leq W
\end{align*}

Now, classify every trace by the isomorphism class of $\bar M - A \cup \partial(\bar M, A)$ and by $\partial(\bar M, A)$.
\begin{Lemma}
	Suppose we have traces $b_1, b_2$ with the same components as above.
	Then $A_{b_1} = A_{b_2}$.
\end{Lemma}

Consider $\bar M - A \cup \partial(\bar M, A)$.
Number of vertices is $\leq (2W)^2$.
Thus number of isomorphism classes $\leq 2^{(2W)^2}$.

Consider $\partial(\bar M, A)$.
Let $N = |A|$.
Order matters, so the total number of choices for it is
\begin{align*}
	N \cdot (N-1) \cdot \ldots \cdot (N - W + 1) = \frac{N!}{(N-W)!}
\end{align*}

Thus the number of possible different traces is bounded by 
\begin{align*}
	2^{(2W)^2} \cdot \frac{N!}{(N-W)!} = O(N^W)
\end{align*}

Since choice of $A$ was arbitrary, this gives
\begin{align*}
	\vc{\phi} \leq W = \frac{|M|Y}{\epsilon_U}
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Technical Lemmas}

\begin{Lemma}
	Suppose we have a set $B$ and a minimal pair $(M, A)$ with $A \subset B$ and $\dim(M/A) = -\epsilon$.
Then either $M \subseteq B$ or $\dim((M \cup B)/B) < -\epsilon$.
\end{Lemma}

\begin{proof}
	By diamond construction

	\begin{align*}
		\dim((M \cup B)/B) \leq \dim(M / (M \cap B))
	\end{align*}

	and 

	\begin{align*}
		\dim(M / (M \cap B)) &= \dim (M/A) - \dim(M / (M \cap B)) \\
		\dim (M/A) &= -\epsilon \\
		\dim(M / (M \cap B)) &> 0
	\end{align*}
\end{proof}



\begin{Lemma}	\label{chain_lemma}
	Suppose we have a set $B$ and a minimal chain $M_n$ with $M_0 \subset B$ and dimensions $-\epsilon_i$.
Let $\epsilon$ be the minimal of $\epsilon_i$.
Then either $M_n \subseteq B$ or $\dim((M_n \cup B)/B) < -\epsilon$.
\end{Lemma}


\begin{proof}
	Let $\bar M_i = M_i \cup B$

	\begin{align*}
		\dim(\bar M_n/B) = \dim(\bar M_n/\bar M_{n-1}) + \ldots + \dim(\bar M_2/\bar M_1) + \dim(\bar M_1/B)
	\end{align*}

	Either $M_n \subseteq B$ or one of the summands above is nonzero.
	Apply previous lemma.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Counterexamples}

% Add complete graph counterexample
% where we have a bunch of minimal extensions intersecting in a tiny way
% or something similar?

% \AA is indiscernible
% example of indiscernible sequence that is not strong
% example with non-strong embedding on every n-tuple of vertices?

% 2 chain minimal extension that is larger than the lower bound
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Upper bound on $\AA$}

Let $n$ be the integer such that $n \epsilon_U < Y$ and $(n+1) \epsilon_U > Y$.

Pick a trace of $\phi(x,y)$ on $A^{|x|}$ by a parameter $b$.

\begin{align*}
	B = \curly{a \in A^{|x|} \mid \phi(a, b)}
\end{align*}

Pick $B' \subset B$, ordered $B' = \{a_i\}_{i \in I}$ such that
\begin{align*}
	%a_i \cap \bigcup_{j \neq i} a_j \neq \emptyset
	a_i \cap \bigcup_{j < i} a_j \neq \emptyset
\end{align*}
This is always possible by starting with $B$ and taking away elements one by one.
Call such a set a \emph{generating set} of $B$.

Let $M_i / \{a_i, b\}$ be a witness of $\phi(a_i, b)$ for each $i \in I$.
Let $\bar M = \bigcup M_i$.
Consider $\bar M / A$.

Pick $\bar M$ such that $\dim(\bar M / A)$ is maximized.

$\bar M \cap A \leq \bar M$ as $A$ is strong. (Make sure $M$ is not too big!)
Let $\bar A = A - \curly{a_i}_{i \in I}$.
Suppose $\bar A \cap \bar M \neq \emptyset$.
Then we can abstractly reembed $\M$ over $A$ such that $\bar A \cap \bar M = \emptyset$.
This would increase the dimension, contradicting maximality.
Thus we can assume $A \cap \bar M = \{a_i\}_{i \in I}$

Let $\bar M_j = \bigcup_{i < j} M_i$.

\begin{Lemma}
	$\dim(\bar M_j / A) \leq j \cdot \epsilon_U$
\end{Lemma}
\begin{proof}
	Proceed by induction.
	Base case is clear.

	For induction case apply lemma to $\bar M_j \cup \{a_j\}$ and $M_j / \{a_j, b\}$.
	There are two cases
	\begin{enumerate}
		\item $M_j \subset \bar M' \cup \{a_j\}$.
		In this case there are edges between $\{a_j\}$ and $M_j$ that contribute to dimension less than $-\epsilon_U$.
		\item Otherwise $M_j$ adds extra dimension less than $-\epsilon_U$
	\end{enumerate}
\end{proof}

Thus we have $\dim(\bar M / A) = \dim(\bar M_n / A) \leq -\epsilon_U n$.

Thus as $A$ is strong we need $|B'| \epsilon_U < Y$.
This gives us $|B'| \leq n$.
Finally we need to relate $|B'|$ to $|B|$.

Suppose we have $C \subset A^{|x|}$, finite with $|C| = N$.
A generating set for a trace has to have size $\leq n$.
Thus there are ${N \choose n} \leq N^n$ choices for a generating set.
A set generated from set of size $n$ can have at most $(x|n|)^{|x|}$ elements.
Thus a given set of size $n$ can generate at most
\begin{align*}
	2^{(x|n|)^{|x|}}
\end{align*}
sets.
Thus the number of possible traces on $C$ is bounded above by
\begin{align*}
  2^{(x|n|)^{|x|}} \cdot N^n = O(N^n)
\end{align*}
This bounds the vc-density by $n$.

\begin{align*}
	\vc_\AA(\phi) \geq \floor{\frac{Y}{\epsilon_U}}
\end{align*}

\end{document}

% Include edges between y as a chain minimal extension