\documentclass{amsart}

\usepackage{../AMC_style}	
\usepackage{../Research}
\usepackage{../Thm}

\usepackage{mathrsfs}



\renewcommand{\AA}{\mathscr A}
  \newcommand{\II}{\mathscr I}
  \newcommand{\MM}{\mathscr M}

  \newcommand{\A}{\mathcal A}
  \newcommand{\B}{\mathcal B}
\renewcommand{\C}{\mathcal C}
  \newcommand{\D}{\mathcal D}
\renewcommand{\H}{\mathcal H}
  \newcommand{\G}{\mathcal G}
  \newcommand{\M}{\mathcal M}
  \newcommand{\U}{\mathcal U}	
  \newcommand{\X}{\mathcal X}
  \newcommand{\Y}{\mathcal Y}

  \newcommand{\K}{\boldface K_\alpha}
\renewcommand{\S}{S_\alpha}

\newcommand{\curly}[1]{\left\{#1\right\}}
\newcommand{\paren}[1]{\left(#1\right)}
\newcommand{\abs}[1]{\left|#1\right|}
\newcommand{\agl}[1]{\left\langle #1 \right\rangle}

\providecommand{\floor}[1]{\left \lfloor #1 \right \rfloor }

%\DeclareMathOperator{\dim}{dim}

\title{Some vc-density computations in Shelah-Spencer graphs}
\author{Anton Bobkov}
\email{bobkov@math.ucla.edu}

\begin{document}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Preliminaries}

VC density was introduced in \cite{vc_density} by Aschenbrenner, Dolich, Haskell, MacPherson, and Starchenko as a natural notion of dimension for NIP theories. In a NIP theory we can define a VC function

\begin{align*}
	\vc : \N \arr \N
\end{align*}

Where $vc(n)$ measures complexity of definable sets in an $n$-dimensional space. Simplest possible behavior is $\vc(n) = n$ for all $n$. Theories with that property are known to be dp-minimal, i.e. having the smallest possible dp-rank. In general, it is not known whether there can be a dp-minimal theory which doesn't satisfy $\vc(n)=n$.

In this paper, we investigate vc-density of definable sets in Shelah-Spencer structures.
We follow notations in \cite{laskowski}.
In this paper we work with limit of random structure $G(n, n^{-\alpha})$ for $\alpha \in (0,1)$, irrational.
This structure is axiomatized by $S_\alpha$.
Our ambient model is $\MM$.
Notations we use are $\delta(\A), \delta(\A/\B), \A \leq \B$ as well as notions of $N$-strong substructure, minimal extension, chain minimal extension, minimal pair, and $N$-strong closure.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Graph Combinatorics}

We denote graph by $\A$, set of its vertices by $A$.
When we say $\A \subseteq \B$ we mean that $A \subseteq B$ and edges of $\A$ are also edges of $\B$.
However $\B$ may add new edges between vertices of $\A$.

Fix $\alpha \in (0,1)$, irrational.
For a finite graph $\A$ let
\begin{align*}
	\delta(\A) = |A| - \alpha e(\A)
\end{align*}

where $e(\A)$ is the number of edges in $\A$.

For finite $\A,\B$ with $\A \subseteq \B$ define $\delta(\B/\A) = \delta(\B) - \delta(\A)$.
We say that $\A \leq \B$ if $\A \subseteq \B$ and $\delta(\A'/\B) > 0$ for all $\A \subseteq \A' \subsetneq \B$.

We say that finite $\A$ is positive if for all $\A' \subseteq \A$ we have $\delta(\A') \geq 0$.

\begin{Definition}
	We work in theory $S_\alpha$ axiomatized by
	\begin{itemize}
		\item Every finite substructure is positive
		\item For a model $\MM$ given $\A \leq \B$ every embedding $f : \A \arr \MM$ extends to $g: \B \arr \MM$.
	\end{itemize}
\end{Definition}

For $\A, \B$ positive, $(\A, \B)$ is called a minimal pair if $\A \subseteq \B$, $\delta(\B/\A) < 0$ but $\delta(\A'/\A) \geq 0$ for all proper $\A \subseteq \A' \subsetneq \B$.

$\agl{\A_i}_{i \leq m}$ is called a minimal chain if $(\A_i, \A_i+1)$ is a minimal pair (for all $i < m$).

For a positive $\A$ let $\delta_\A(\bar x)$ be the atomic diagram of $\A$. For positive $\A \subset \B$ let 

\begin{align*}
	\Psi_{\A,\B}(\bar x) = \delta_\A(\bar x) \wedge \exists \bar y \; \delta_\B(\bar x, \bar y)
\end{align*}

Such formula is called chain-minimal extension formula if in addition we have that there is a minimal chain starting at $\A$ and ending in $\B$. Denote such formulas as $\Psi_{\agl{\M_i}}$

\begin{Theorem} [5.6 in \cite{laskowski}]
	$S_\alpha$ admits quantifier elimination down to boolean combination of chain-minimal extension formulas.
\end{Theorem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Definitions}

%\begin{Definition}
	%Let $x = (x_1, \ldots x_n), y = (y_1, \ldots, y_m)$ be variable tuples.
	%We call a formula $\phi(x, y)$ \emph{basic} when
	%\begin{itemize}
		%\item $\phi(x, y)$ is a minimal chain extension, denoted by $\curly{M_i}_{i \in [0..k]}$ with $M_0 = \{x, y\}$.
		%\item $\phi(x, y)$ determines edges and non-edges on its variables $\{x_1, \ldots x_n\} \cup \{y_1, \ldots y_m\}$.
		%\item there is no edge between $x_i$ and $y_j$ for all $i,j$. (see note \ref{note_edges})
		%\item Define $\mathbf x$ to be the graph on vertices $\{x_i\}$ with edges as defined by $\phi$.
		%Similarly define $\mathbf y$.
		%We require $\mathbf x$ and $\mathbf y$ to be positive. (see note \ref{note_positive})\
		%%\item all elements of $y$ that are connected to $M_k - \{x,y\}$. (see note \ref{note_special})
	%\end{itemize}
%\end{Definition}

% issue: multiple possible chain decompositions?

Fix tuples $x = (x_1, \ldots x_n), y = (y_1, \ldots, y_m)$.
We refer to chain-minimal extension formulas as basic formulas.
Let $\phi_{\agl{\M_i}}(x, y)$ be a basic formula.

\begin{Definition}
	Define $\X$ to be the graph on vertices $\{x_i\}$ with edges as defined by $\phi_{\agl{\M_i}}$.
	Similarly define $\Y$.
	We define those abstractly, i.e. on a new set of vertices disjoint from $\MM$.
\end{Definition}

Note that $\X$, $\Y$ are positive as they are subgraphs of $\M_0$.
As usual $X, Y$ will refer to vertices of those graphs.

We restrict our attention to formulas that define no edges between $X$ and $Y$.

\begin{Note} \label{note_edges}
	We can handle edges between $x$ and $y$ as separate elements of the minimal chain extension.
\end{Note}

%\begin{Note} \label{note_positive}
	%If either graph $\mathbf x$ or $\mathbf y$ is negative, then the formula would have no realizations as negative graphs cannot be embedded into our ambient model.
%\end{Note}

%\begin{Note} \label{note_special}
	%We add the final condition to simplify our analysis. Similar techniques can be used to acquire bounds on formulas not subject to that condition.
%\end{Note}

\begin{Definition} \label{def_basic}
	For a basic formula $\phi = \phi_{\agl{\M_i}_{i \leq k}}(x, y)$ let
	\begin{itemize}
		\item $\epsilon_i(\phi) = -\dim \paren{M_i/M_{i-1}}$.
		\item $\epsilon_L(\phi) = \sum_{[1..k]} \epsilon_i(\phi)$.
		\item $\epsilon_U(\phi) = \min_{[1..k]} \epsilon_i(\phi)$.
		\item Let $\Y'$ be a subgraph of $\Y$ induced by vertices of $\Y$ that are connected to $M_k - (X \cup Y)$.
		\item Let $Y(\phi) = \dim (\Y')$.
		In particular if $\Y = \Y'$ and $\Y$ is disconnected then $Y(\phi)$ is just the arity of the tuple $y$.
	\end{itemize}
\end{Definition}

%\begin{Definition}
%\begin{align*}
	%\epsilon_L(\neg \phi) &= \epsilon_L(\phi) \\
	%\epsilon_U(\neg \phi) &= \epsilon_U(\phi) \\
	%\epsilon_L(\phi \wedge \psi) &= \epsilon_L(\phi) + \epsilon_L(\psi) \\
	%\epsilon_U(\phi \wedge \psi) &= \min(\epsilon_U(\phi), \epsilon_U(\psi)) \\
	%\epsilon_L(\phi \vee \psi) &= \min(\epsilon_L(\phi), \epsilon_L(\psi)) \\
	%\epsilon_U(\phi \vee \psi) &= \min(\epsilon_U(\phi), \epsilon_U(\psi)) 
%\end{align*}
%\end{Definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Lower bound}

As a simplification for our lower bound computation we assume that all the basic formulas involved we have $\Y' = \Y$ (see Definition \ref{def_basic}).

We work with formulas that are boolean combinations of basic formulas written in disjunctive-conjunctive form.
First, we extend our definition of $\epsilon$.

\begin{Definition}[Negation]
	If $\phi$ is a basic formula, then define
	\begin{align*}
		\epsilon_L(\neg \phi) &= \epsilon_L(\phi)
	\end{align*}
\end{Definition}

\begin{Definition}[Conjunction]
	Take a collection of formulas $\phi_i(x, y)$ where each $\phi_i$ is positive or negative basic formula.
	If both positive and negative formulas are present then $\epsilon_L(\phi) = \infty$.
	We don't have a lower bound for that case.
	If different formulas define $\X$ or $\Y$ differently then $\epsilon_L(\phi) = \infty$.
	In that case of the conflicting definitions would make the formula have no realizations.
	Otherwise
	\begin{align*}
		\epsilon_L(\bigwedge \phi_i) &= \sum \epsilon_L(\phi_i)
	\end{align*}
\end{Definition}

\begin{Definition} [Disjunction]
	Take a collection of formulas $\psi_i$ where each instance is a conjunction of positive and negative instances of basic formulas that agree on $\X$ and $\Y$. % can generalize?
	\begin{align*}
		\epsilon_L(\bigvee \psi_i) &= \min \epsilon_L(\psi_i)
	\end{align*}
\end{Definition}

\begin{Theorem}
	For a formula $\phi$ as above
	\begin{align*}
		\vc \phi \geq \floor{\frac{Y(\phi)}{\epsilon_L(\phi)}}
	\end{align*}
	where $Y(\phi)$ is $Y(\psi)$ for $\psi$ one the basic components of $\phi$ (all basic componenets agree on $\Y$).
\end{Theorem}

\begin{proof}
	First work with a formula that is a conjunction of positive basic formulas.

	\begin{align*}
		\psi = \bigwedge_{j \leq J} \phi_j
	\end{align*}
	Then as we defined above
	\begin{align*}
		\epsilon_L(\psi) = \sum \epsilon_L(\phi_j)
	\end{align*}
	
	Let $\phi$ be one of the basic formulas in $\psi$ with a chain $\agl{M_i}_{i \leq k}$.
	Let $K_\phi = |M_k|$ i.e. the size of the extension.
	Let $K$ be the largest such size among all $\phi_i$.

	Let $n$ be the integer such that $n \epsilon_L(\psi) < Y$ and $(n+1) \epsilon_L(\psi) > Y$.

	%Take an abstract realization of $y$ as dictated by $\psi$, and label it by $b$ ($b \in \MM$)
	Label $\Y$ by an tuple $b$.

	Pick parameter set $A \subset \MM$ such that 

	\begin{align*}
		A = \bigcup_{i<N} b_i
	\end{align*}

	a disjoint union where each $b_i$ is an ordered tuple of size $|x|$ connected according to $\psi$.
	We also require $A$ to be $N \cdot I \cdot K$-strong.

	Fix $n$ arbitrary elements out of $A$, label them $a_j$.

	For each $\phi_i$, $a_j$ pick an abstract realization $M_{ij}$ of $\phi_i$ over $(a_j, b)$
	(abstract meaning disjoint from $\MM$).
	
	Let $\bar M$ be an abstract disjoint union of all those realizations.

	\begin{Claim}
		$(A \cap \bar M) \leq \bar M$.
	\end{Claim}
	\begin{proof}
		Consider some $(A \cap \bar M) \subseteq B \subseteq \bar M$.
		Let $B_{ij} = B \cap M_{ij} \subseteq M_{ij}$.
		Then $B_{ij}$'s are disjoint over $\bar A = A \cup b$.
		In particular $\dim B / (\bar A \cap B) = \sum \dim B_{ij} / (\bar A \cap B_{ij})$.
		$\dim B_{ij} / \bar A \geq -\epsilon_L(\phi_i)$ by Lemma \ref{chain_intersect}.
		Thus $\dim B / (\bar A \cap B) \geq -n\epsilon(\psi)$.
		Thus $\dim B / (A \cap B) \geq \dim(B) - n\epsilon(\psi)$.
		By construction we have $Y - n\epsilon_L(\psi) > 0$ as needed.
	\end{proof}

	$|\bar M| \leq N \cdot I \cdot K$ and $A$ is $\leq N \cdot I \cdot K$-strong.
	Thus a copy of $\bar M$ can be embedded over $A$ into our ambient model $\MM$.
	Our choice of $b_i$'s was arbitrary, so we get ${N \choose n}$ choices out of $N|x|$ many elements.
	Thus we have $O(|A|^n)$ many traces.

	\begin{Lemma}
		There are arbitrarily large sets with properties of $A$.
	\end{Lemma}
	
	\begin{proof}
		$A$ is positive, as each of its disjoint components is positive. Thus $0 \leq A$.
		We apply proposition 4.4 in Laskoswki paper, embedding $A$ into our structure $\MM$ while avoiding all nonpositive extensions of size at most $N \cdot I \cdot K$.
	\end{proof}

	This shows

	\begin{align*}
		\vc \psi \geq n = \floor{\frac{Y}{\epsilon_L}}
	\end{align*}

	Now consider the formula which is a conjunction consists of negative basic formulas
	\begin{align*}
		\psi = \bigwedge \neg \phi_i
	\end{align*}
	Let
	\begin{align*}
		\bar \psi = \bigwedge \phi_i
	\end{align*}

	Do the construction above for $\bar \psi$ and suppose its trace is $X \subset A$ for some $b$.
	Then over $b$ the same construction gives trace $(A - X)$ for $\psi$. Thus we get as many traces.
	
	Finally consider a formula which is a disjunction of formulas considered above.
	Choose the one with the smallest $\epsilon_L$, this yields the lower bound for the entire formula.
	%explain! non-trivial. thing of disjunction of two formulas
	% also! what if disjunction has formulas disagreeing on x and y
	% aslo! what if disjuction where one of the formulas is mixed positive/negative formulas
\end{proof}

\begin{Claim}
	We can find a minimal extension $M / \{x, y\}$ with arbitrarily small dimension.
\end{Claim}

\begin{proof}
	Put proof in here. Follow construction in Laskowski paper.
\end{proof}

This shows that vc function is infinite in Shelah-Spencer random graphs.

\begin{align*}
	\vc(n) = \infty
\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Upper bound}


%\begin{Definition}
	%Let $\phi$ be a basic formula with $M_i$ a minimal chain,
	%$\epsilon_i$ its corresponding dimensions,
	%and $M$ its total size.
	%\begin{align*}
		%U_\phi = \frac{M}{\min \epsilon_i}
	%\end{align*}
%\end{Definition}



%\begin{Definition} [Negation]
	%Let $\phi$ be basic
	%\begin{align*}
		%U_{\neg \phi} = U_{\phi}
	%\end{align*}
%\end{Definition}
%
%\begin{Definition} [Conjunction and Disjunction]
	%Let $\phi_{ij}$ be basic or a negation of a basic formula.
	%\begin{align*}
		%\psi = \bigvee \bigwedge \phi_{ij}
	%\end{align*}
	%\begin{align*}
		%U_\psi = \max U_{\phi_{ij}}
	%\end{align*}
%\end{Definition}

%Let $n$ be the integer such that $n \epsilon_U < Y$ and $(n+1) \epsilon_U > Y$.

%Consider a formula which is a conjunction of positive basic formulas.

%Consider a case of a single basic formula $\phi(\vec x, \vec y)$.

We bound the number of types of some finite collection of formulas $\Psi(\vec x, \vec y) = \curly{\phi_i(\vec x, \vec y)}_{i\in I}$ over a parameter set $B$ of size $N$,
where $\phi_i$ is a basic formula.

Fix a formula $\phi$ from our collection.
Suppose it defines a minimal chain extension over $\{x, y\}$. 
Record the size of that extension as $K(\phi)$ and its total dimension $\epsilon(\phi) = \epsilon_U(\phi)$.

In general we have parameter set $B \subset \MM^{|y|}$, however without loss of generality we may work with
a parameter set $B^{|y|}$, with $B \subset \MM$.

Let $S = |\vec y| \cdot \max_{i \in I} \floor{\frac{K(\phi_i)}{\epsilon(\phi_i)}}$.

For our proof to work we also need $B$ to be $S$-strong.
We can achieve this by taking (the unique) $S$-strong closure of $B$.
If size of $B$ is $N$ then the size of its closure is $O(N)$.	%elaborate
So without loss of generality we can assume that $B$ is $S$-strong.

\begin{Definition}
	A \emph{witness} of $a$ is a union of realizations of the existential formulas $\phi_i(a, b)$ for all $i, b$ so that the formula holds.
\end{Definition}


 % what about A \cap b???

\begin{Definition}
	For sets $C, A$ define the boundary of $C$ over $A$
	\begin{align*}
		\partial(C, A) = \curly{a \in A \mid \text{there is an edge between $a$ and element of $C - A$}}
	\end{align*}
\end{Definition}

\begin{Definition}
	For each $b$ pick some $\bar M_b$ to be a witness of $A_b$.
	Let $\bar A = A \cup b$.
	Define two quantities
	\begin{itemize}
		\item $\partial_b$ is the boundary $\partial(\bar M_b, \bar A)$
		\item Call $f \colon G_1 \arr G_2$ a $\partial$-isomorphism if it is a graph isomorphism and $f$ and $f^{-1}$ are constant on $\bar A$.
		Define $\II_b$ as the $\partial$-isomorphism class of the graph induced on vertices $(\bar M_b - \bar A) \cup \partial_b$. %depends on witness choice
	\end{itemize}
\end{Definition}

\begin{Lemma} \label {bound_trace}
	If $\II_{b_1} = \II_{b_2}$ then $A_{b_1} = A_{b_2}$.
\end{Lemma}

\begin{proof}
	Fix witnesses $\bar M_{b_1}, \bar M_{b_2}$.
	Suppose we have $\phi(a, b_1)$ for some $a$.
	Pick its witness $M_1 \subset \bar M_{b_1}$.
	This gives us a witness $M_2$ via the $\partial$-isomorphism.
\end{proof}

Thus to bound the number of traces it is sufficient to bound the number of possibilities for $\II_b$.

\begin{Theorem} \label{main_bound}
	\begin{align*}
		|\partial_b| &\leq K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}\\
		|\bar M_b - \bar A| &\leq K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}
	\end{align*}
\end{Theorem}

\begin{Corollary}
	\begin{align*}
		\vc(\phi) \leq K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}
	\end{align*}
\end{Corollary}

\begin{proof}
		We count possible $\partial$-isomorphism classes $\II_b$.
		Let $W = K(\phi) \frac{Y(\phi)}{\epsilon(\phi)}$.
		If the parameter set $A$ is of size $N$ then there are $N \choose W$ choices for boundary $\partial_b$.
		On top of the boundary there are at most $W$ extra vertices and $(2W)^2$ extra edges.
		Thus there are at most
		\begin{align*}
			W \cdot 2^{(2W)^2}
		\end{align*}
		configurations up to a graph isomorphism.
		In total this gives us 
		\begin{align*}
			{N \choose W} \cdot W \cdot 2^{(2W)^2} = O(N^W)
		\end{align*}
		options for $\partial$-isomorphism classes.
		By Lemma \ref{bound_trace} there are at most $O(N^W)$ many traces, giving the required bound.
\end{proof}

\begin{proof} \textit{(of Theorem \ref{main_bound})}
	Fix some $b$-trace $A_b$. Enumerate $A_b = \{a_1, \ldots, a_I\}$.

	Let $M_i / \{a_i, b\}$ be a witness of $\phi(a_i, b)$ for each $i \leq I$.
	Let $\bar M_i = \bigcup_{j < i} M_j$.
	Let $\bar M = \bigcup M_i$, a witness of $A_b$
	
	\begin{Claim}
		\begin{align*}
			&\abs{\partial(M_i M, \bar A) - \partial(M, \bar A)} \leq |M_i| = K(\phi)\\
			&\dim(M_i M \bar A / M \bar A) > -\epsilon(\phi)
		\end{align*}
	\end{Claim}
	
	\begin{Definition}
		$(j-1, j)$ is called a \emph{jump} if some of the following conditions happen
		\begin{itemize}
			\item New vertices are added outside of $\bar A$ i.e.
				\begin{align*}
					\bar M_j - \bar A \neq \bar M_{j-1} - \bar A
				\end{align*}
			\item New vertices are added to the boundary, i.e.
				\begin{align*}
					\partial(\bar M_j, \bar A) \neq \partial(\bar M_{j-1}, \bar A)
				\end{align*}
		\end{itemize}
	\end{Definition}

	\begin{Definition}
		We now let $m_i$ count all jumps below $i$
		%Let $d_i = \dim(\bar M_i/A)$.
		\begin{align*}
			m_i = \abs{\curly{j < i \mid (j-1, j) \text{ is a jump}}}
		\end{align*}
	\end{Definition}

	\begin{Lemma} \label{ub_lemma}
		\begin{align*}
			\dim(\bar M_i / \bar A) &\leq -m_i \cdot \epsilon(\phi) \\
			|\partial(\bar M_i, \bar A)| &\leq m_i \cdot K(\phi) \\
			|\bar M_j - \bar A| &\leq m_i \cdot K(\phi)
		\end{align*}
	\end{Lemma}

	\begin{proof} \textit{(of Lemma \ref{ub_lemma})}
		Proceed by induction.
		Second and third propositions are clear.
		For the first proposition base case is clear.
		
		Induction step.
		Suppose $\bar M_j \cap (A \cup b) = \bar M_{j+1}$ and $\partial(\bar M_j, A) = \partial(\bar M_{j+1}, A)$.
		Then $m_i = m_{i+1}$ and the quantities don't change.
		Thus assume at least one of these equalities fails.
		
		Apply Lemma \ref{chain_lemma} to $\bar M_j \cup (A \cup b)$ and $(M_{j+1}, a_{j+1}b)$.
		There are two options
		
		\begin{itemize}
			\item $\dim(\bar M_{j+1} \cup (A \cup b) / \bar M_i \cup (A \cup b)) \leq -\epsilon_U$.
			This implies the proposition.
			\item $M_{j+1} \subset \bar M_j \cup (A \cup b)$.
			Then by our assumption it has to be $\partial(\bar M_j, A) \neq \partial(\bar M_{j+1}, A)$.
			There are edges between $M_{j+1} \cap (\partial(\bar M_{j+1}, A) - \partial(\bar M_j, A))$ so they contribute some negative dimension $\leq \epsilon_U$.
		\end{itemize}
		This ends the proof for Lemma \ref{ub_lemma}.
	\end{proof}
	\textit{(Proof of Theorem \ref{main_bound} continued)}
	First part of lemma \ref{ub_lemma} implies that we have $\dim(\bar M / \bar A) \leq -m_I \cdot \epsilon(\phi)$.
	The requirement of $A$ to be $S$-strong forces
	\begin{align*}
		m_I \cdot \epsilon(\phi) &< Y(\phi) \\
		m_I  &< \frac{Y(\phi)}{\epsilon(\phi)} \\
	\end{align*}
	%Let $W = \frac{K(\phi)Y(\phi)}{\epsilon(\phi)}$
	Applying the rest of \ref{ub_lemma} gives us
	\begin{align*}
		|\partial(\bar M, A)| &\leq m_I \cdot K(\phi) \leq \frac{K(\phi)Y(\phi)}{\epsilon(\phi)} \\
		|\bar M \cap A| &\leq m_I \cdot K(\phi) \leq \frac{K(\phi)Y(\phi)}{\epsilon(\phi)}
	\end{align*}
	as needed.
	This ends the proof for Theorem \ref{main_bound}.
\end{proof}

So far we have computed an upper bound for a single basic formula $\phi$.

To bound an arbitrary formula, write it as a boolean combination of basic formulas $\phi_i$ (via quantifier elimination)
It suffices to bound vc-density for collection of formulas $\{\phi_i\}$ to obtain a bound for the original formula.

In general work with a collection of basic formulas $\{\phi_i\}_{i \in I}$.
The proof generalizes in a straightforward manner.
Instead of $A^{|x|}$ we now work with $A^{|x|} \times I$ separating traces of different formulas.
Formula with the largest quantity $Y(\phi)\frac{K(\phi)}{\epsilon(\phi)}$ contributes the most to the vc-density.
Thus we have
\begin{align*}
	\Phi &= \{\phi_i\}_{i \in I} \\
	\vc(\Phi) &=  \max_{i \in I} Y(\phi_i) \frac{K(\phi_i)}{\epsilon_{\phi_i}}
\end{align*}


%\begin{Definition}
	%\begin{align*}
		%d &= \dim \bar M / \bar A \\
		%s &= |\bar M - \bar A| \\
		%b &= |\partial(\bar M, \bar A)|
	%\end{align*}
%\end{Definition}


%Thus as we consider $\bar M$ as an increasing union of witnesses to chain-minimal extensions, we see the extension with the largest ratio can contribute most to the boundary.
%Thus is our upper bound for the boundary.






%Now, classify every trace by the isomorphism class of $\bar M - A \cup \partial(\bar M, A)$ and by $\partial(\bar M, A)$.
%\begin{Lemma}
	%Suppose we have traces $b_1, b_2$ with the same components as above.
	%Then $A_{b_1} = A_{b_2}$.
%\end{Lemma}
%
%Consider $\bar M - A \cup \partial(\bar M, A)$.
%Number of vertices is $\leq (2W)^2$.
%Thus number of isomorphism classes $\leq 2^{(2W)^2}$.
%
%Consider $\partial(\bar M, A)$.
%Let $N = |A|$.
%Order matters, so the total number of choices for it is
%\begin{align*}
	%N \cdot (N-1) \cdot \ldots \cdot (N - W + 1) = \frac{N!}{(N-W)!}
%\end{align*}
%
%Thus the number of possible different traces is bounded by 
%\begin{align*}
	%2^{(2W)^2} \cdot \frac{N!}{(N-W)!} = O(N^W)
%\end{align*}
%
%Since choice of $A$ was arbitrary, this gives
%\begin{align*}
	%\vc{\phi} \leq W = \frac{|M|Y}{\epsilon_U}
%\end{align*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Technical Lemmas}

\begin{Lemma}
	Suppose we have a set $B$ and a minimal pair $(M, A)$ with $A \subset B$ and $\dim(M/A) = -\epsilon$.
Then either $M \subseteq B$ or $\dim((M \cup B)/B) < -\epsilon$.
\end{Lemma}

\begin{proof}
	By diamond construction

	\begin{align*}
		\dim((M \cup B)/B) \leq \dim(M / (M \cap B))
	\end{align*}

	and 

	\begin{align*}
		\dim(M / (M \cap B)) &= \dim (M/A) - \dim(M / (M \cap B)) \\
		\dim (M/A) &= -\epsilon \\
		\dim(M / (M \cap B)) &> 0
	\end{align*}
\end{proof}



\begin{Lemma}	\label{chain_lemma}
	Suppose we have a set $B$ and a minimal chain $M_n$ with $M_0 \subset B$ and dimensions $-\epsilon_i$.
Let $\epsilon$ be the minimal of $\epsilon_i$.
Then either $M_n \subseteq B$ or $\dim((M_n \cup B)/B) < -\epsilon$.
\end{Lemma}


\begin{proof}
	Let $\bar M_i = M_i \cup B$

	\begin{align*}
		\dim(\bar M_n/B) = \dim(\bar M_n/\bar M_{n-1}) + \ldots + \dim(\bar M_2/\bar M_1) + \dim(\bar M_1/B)
	\end{align*}

	Either $M_n \subseteq B$ or one of the summands above is nonzero.
	Apply previous lemma.
\end{proof}

\begin{Lemma} \label{chain_intersect}
	Suppose we have a minimal chain $M_n$ with dimensions $-\epsilon_i$.
	Let $\epsilon$ be the sum of all $\epsilon_i$.
	Suppose we have some $B$ with $B \subseteq M_n$.
	Then $\dim B / (M_0 \cap B) \geq -\epsilon$.
\end{Lemma}

\begin{proof}
	Let $B_i = B \cap M_i$.
	We have $\dim B_{i+1}/B_i \geq \dim M_{i+1}/M_i$ by minimality.
	$\dim B / (M_0 \cap B) = \dim B_n / B_0 = \sum \dim B_{i+1}/B_i \geq -\epsilon$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Counterexamples}

% Add complete graph counterexample
% where we have a bunch of minimal extensions intersecting in a tiny way
% or something similar?

% \AA is indiscernible
% example of indiscernible sequence that is not strong
% example with non-strong embedding on every n-tuple of vertices?

% 2 chain minimal extension that is larger than the lower bound
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Upper bound on $\AA$}

\begin{Definition}
	\begin{align*}
		\AA = \curly{A \subset \U^{y} \mid \text{finite, disconnected, strongly embedded}}
	\end{align*}
\end{Definition}

Let $n$ be the integer such that $n \epsilon_U < Y$ and $(n+1) \epsilon_U > Y$.

Pick a trace of $\phi(x,y)$ on $A^{|x|}$ by a parameter $b$.

\begin{align*}
	B = \curly{a \in A^{|x|} \mid \phi(a, b)}
\end{align*}

Pick $B' \subset B$, ordered $B' = \{a_i\}_{i \in I}$ such that
\begin{align*}
	%a_i \cap \bigcup_{j \neq i} a_j \neq \emptyset
	a_i \cap \bigcup_{j < i} a_j \neq \emptyset
\end{align*}
This is always possible by starting with $B$ and taking away elements one by one.
Call such a set a \emph{generating set} of $B$.

Let $M_i / \{a_i, b\}$ be a witness of $\phi(a_i, b)$ for each $i \in I$.
Let $\bar M = \bigcup M_i$.
Consider $\bar M / A$.

Pick $\bar M$ such that $\dim(\bar M / A)$ is maximized.

$\bar M \cap A \leq \bar M$ as $A$ is strong. (Make sure $M$ is not too big!)
Let $\bar A = A - \curly{a_i}_{i \in I}$.
Suppose $\bar A \cap \bar M \neq \emptyset$.
Then we can abstractly reembed $\M$ over $A$ such that $\bar A \cap \bar M = \emptyset$.
This would increase the dimension, contradicting maximality.
Thus we can assume $A \cap \bar M = \{a_i\}_{i \in I}$

Let $\bar M_j = \bigcup_{i < j} M_i$.

\begin{Lemma}
	$\dim(\bar M_j / A) \leq j \cdot \epsilon_U$
\end{Lemma}
\begin{proof}
	Proceed by induction.
	Base case is clear.

	For induction case apply lemma to $\bar M_j \cup \{a_j\}$ and $M_j / \{a_j, b\}$.
	There are two cases
	\begin{enumerate}
		\item $M_j \subset \bar M' \cup \{a_j\}$.
		In this case there are edges between $\{a_j\}$ and $M_j$ that contribute to dimension less than $-\epsilon_U$.
		\item Otherwise $M_j$ adds extra dimension less than $-\epsilon_U$
	\end{enumerate}
\end{proof}

Thus we have $\dim(\bar M / A) = \dim(\bar M_n / A) \leq -\epsilon_U n$.

Thus as $A$ is strong we need $|B'| \epsilon_U < Y$.
This gives us $|B'| \leq n$.
Finally we need to relate $|B'|$ to $|B|$.

Suppose we have $C \subset A^{|x|}$, finite with $|C| = N$.
A generating set for a trace has to have size $\leq n$.
Thus there are ${N \choose n} \leq N^n$ choices for a generating set.
A set generated from set of size $n$ can have at most $(x|n|)^{|x|}$ elements.
Thus a given set of size $n$ can generate at most
\begin{align*}
	2^{(x|n|)^{|x|}}
\end{align*}
sets.
Thus the number of possible traces on $C$ is bounded above by
\begin{align*}
  2^{(x|n|)^{|x|}} \cdot N^n = O(N^n)
\end{align*}
This bounds the vc-density by $n$.

\begin{align*}
	\vc_\AA(\phi) \geq \floor{\frac{Y}{\epsilon_U}}
\end{align*}


\begin{thebibliography}{9}

\bibitem{vc_density}
	M. Aschenbrenner, A. Dolich, D. Haskell, D. Macpherson, S. Starchenko,
	\textit{Vapnik-Chervonenkis density in some theories without the independence property}, I, preprint (2011)
	
\bibitem{laskowski}
  Michael C. Laskowski, \textit{A simpler axiomatization of the Shelah-Spencer almost sure theories},
  Israel J. Math. \textbf{161} (2007), 157–186. MR MR2}350161	

\end{thebibliography}
	
\end{document}

% Include edges between y as a chain minimal extension