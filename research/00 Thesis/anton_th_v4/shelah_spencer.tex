\chapter{Shelah-Spencer Graphs}
In this \chapa we investigate VC-density of definable sets in Shelah-Spencer graphs.
We provide an upper bound on a formula-by-formula basis and show that there isn't a uniform lower bound,
forcing the VC-density function to be infinite.
In addition we show that Shelah-Spencer graphs do not have a finite dp-rank,
thus, in particular, they are not dp-minimal.


A Shelah-Spencer graph is a limit of random structures $G(n, n^{-\alpha})$ for an irrational $\alpha \in (0,1)$.
Here $G(n, n^{-\alpha})$ is a random graph on $n$ vertices with edge probability $n^{-\alpha}$.
(The model theory of $G(n, n^{-\alpha})$ as $n \to \infty$ is much less pleasant if $\alpha \in (0,1)$ is rational, see \cite{rational}.)
In \cite{spencer} Shelah and Spencer showed that such structures have a 0-1 law, thus obtaining
a complete (first-order) theory of Shelah-Spencer graphs.
These structures are of a general combinatorial interest as well.
For example, \cite{anthony} computes the VC-dimension of neighborhood sets in finite Shelah-Spencer graphs.
Our treatment of Shelah-Spencer graphs closely follows the one in \cite{laskowski}.

Our first result is that Shelah-Spencer graphs have $\vc(n) = \infty$ for each $n$.
% We also show that Shelah-Spencer graphs don't have a finite dp-rank, which in particular implies that they are not dp-minimal.
Our second result gives an upper bound on the VC-density of a given formula $\phi(x, y)$:
\begin{align*}
  \vc(\phi) \leq \DPHI
\end{align*}
where $K(\phi), \epsilon(\phi)$ are explicitly computable expressions involving the number of vertices and edges defined by $\phi$.
For example, let $\phi(x,y)$ be a formula that says that there is an edge between $x$ and $y$.
Our bound gives $\vc(\phi) \leq \floor{\frac{2}{\alpha}}$.
With a more careful computation one can get the exact value $\vc(\phi) = \floor{\frac{1}{\alpha}}$ (see 4.9 in \cite{density}).

Sec\-tion~1 summarizes notation and basic facts concerning Shelah-Spencer graphs.
We direct the reader to \cite{laskowski} for a more in-depth treatment.
In Sec\-tion~2 we introduce key lemmas that will be useful in our proofs.
Sec\-tion~3 computes a lower bound for VC-density to demonstrate that $\vc(n) = \infty$.
We also do some computations involving dp-rank.
Sec\-tion~4 computes an upper bound for VC-density on a formula-by-formula basis.
The concluding section discusses open questions and future work.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Graph Combinatorics}
Throughout this \chapa $A, B, C, M$ (sometimes with decorations) denote finite graphs,
and $\DB$ is used to denote potentially infinite graphs.
All graphs are undirected and asymmetric.
For a graph $A$ the set of its vertices is denoted by $v(A)$, and the set of its edges by $e(A)$.
The number of vertices of $A$ is denoted by $|A|$.
Subgraph always means induced subgraph and $A \subseteq \DB$ means that $A$ is a subgraph of $\DB$.
For two subgraphs $A, B$ of a larger graph, the union $A \cup B$ denotes the graph induced by $v(A) \cup v(B)$.
Similarly, $A - B$ means a subgraph of $A$ induced by the vertices of $v(A) - v(B)$.
For $A \subseteq B \subseteq \DB$ and $A \subseteq C \subseteq \DB$,
graphs $B,C$ are said to be \defn{disjoint over $A$} if $v(B) - v(A)$ is disjoint from $v(C) - v(A)$
and there are no edges from $v(B) - v(A)$ to $v(C) - v(A)$ in $\DB$.
We often confuse a tuple of vertices $a = (a_1, \ldots, a_n) \in \DB^n$ with the subgraph $a = \curly{a_1, \ldots, a_n} \subseteq \DB$.

For the remainder of the \chapa fix $\alpha \in (0,1)$, irrational.
\begin{Definition} \ 
  \begin{itemize}
  \item For a graph $A$ let $\dim(A) = |A| - \alpha |e(A)|$. (Note that this may be negative.)
  \item For $A,B$ with $A \subseteq B$ define $\dim(B/A) = \dim(B) - \dim(A)$.
  \item We say that $A \leq B$ if $A \subseteq B$ and $\dim(A'/A) > 0$ for all $A \subsetneq A' \subseteq B$.
  \item Define $A$ to be \defn{positive} if for all $A' \subseteq A$ we have $\dim(A') \geq 0$.
  \item We work in theory $S_\alpha$ in the language of graphs axiomatized by the following conditions:
    \begin{itemize}
    \item Every finite substructure is positive.
    \item Given a model $\GG$ and graphs $A \leq B$, every embedding $f : A \arr \GG$ extends to an embedding $g: B \arr \GG$.
    \end{itemize}
    (Here an embedding is taken in the model-theoretic sense, of structures in the language of graphs, so each embedding
    maps edges to edges and nonedges to nonedges.)
    This theory is complete and stable (see 5.7 and 7.1 in \cite{laskowski}).
    From now on, fix an ambient model $\GG \models S_\alpha$.
    This will be the only infinite graph we work with.
    % We denote the set of its vertices by $G$.
  \item Given $S \in \N$, a graph $S \subseteq \GG$ is called \defn{$S$-strong}
    if for any $R \subseteq T \subseteq \GG$ with $|T| - |R| \leq S$ we have $R \leq T$.
  \item For $A, B$ positive, $(A, B)$ is called a \defn{minimal pair} if we have
    $A \subseteq B$, $\dim(B/A) < 0$ but $\dim(A'/A) \geq 0$ for all proper $A \subseteq A' \subsetneq B$.
    We call $B$ a \defn{minimal extension} of $A$.
    The dimension of a minimal pair is defined as $|\dim(B/A)|$.
  \item A sequence $\agl{M_i}_{0 \leq i \leq n}$ of finite graphs is called a \defn{minimal chain}
    if $(M_i, M_{i+1})$ is a minimal pair for all $0 \leq i < n$.
  \item Suppose we have a graph $A$ with vertices $v(A) = \curly{x_1, \ldots, x_n}$ with pairwise disjoint $x_i$.
    For the variable tuple of vertices $x = (x_1, \ldots, x_n)$ let $\diag_A(x)$ be the atomic diagram of $A$,
    i.e., the first-order formula recording whether there is an edge or a nonedge between every pair of vertices.
    So for a graph $\DB$ and a tuple $a = (a_1, \ldots, a_n)$ we have $\DB \models \diag_A(a)$ if and only if
    there exists an embedding $f \colon A \arr \DB$ such that $f(x_i) = a_i$.
  % \item Suppose we have a graph $A$ with vertices $v(A) = \curly{a_1, \ldots, a_n}$.
  %   For the variable tuple $x = (x_1, \ldots, x_n)$ let $\diag_A(x)$ be the atomic diagram of $A$,
  %   i.e. the first-order formula that says that there is an edge between $x_i$ and $x_j$ if and only if
  %   there is an edge between $a_i$ and $a_j$.
  %   So for a graph $\DB$ and a tuple $b = (b_1, \ldots, b_n) \in \DB^n$ we have $\DB \models \diag_A(b)$ if and only if
  %   there exists an embedding $f \colon A \arr \DB$ such that $f(a_i) = b_i$ for each $i$.
  \item Given $A \subseteq B$ let 
    \begin{align*}
      \phi_{A,B}(x) = \diag_A(x) \wedge \exists z \; \diag_B(x, z).
    \end{align*}
    Any graph isomorphic to $B$ is called a \defn{witness of $\phi_{A,B}$}.
    Work in a graph $\DB$.
    Suppose $\DB \models \phi_{A,B}(a)$ for some tuple $a = (a_1, \ldots, a_m)$
    and we have a finite subgraph $B' \subset \DB$ with vertices $v(B') = \curly{b_1, \ldots b_n}$
    such that $b_i = a_i$ for $i = 1, \ldots, m$ and $\DB \models \diag_B(b)$.
    In this case we call such a graph $B'$ a \defn{witness of $\phi_{A,B}(a)$}.
  \item A formula $\phi_{A,B}$ is called a \defn{basic formula}
    if there is a minimal chain $\agl{M_i}_{0 \leq i \leq n}$
    such that $A = M_0$ and $B = M_n$.
    We also denote such a formula by $\phi_{\agl{M_i}_{0 \leq i \leq n}}$. 
  \end{itemize}
\end{Definition}
 
\begin{Theorem} [Quantifier simplification, 5.6 in \cite{laskowski}]
  In the theory $S_\alpha$ every formula is equivalent to a boolean combination of basic formulas.
\end{Theorem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Basic Definitions and Lemmas}
We require the following lemmas from \cite{laskowski}:

\begin{Lemma} \label{diamond} [See 2.3 in \cite{laskowski}]
  Let $A, B \subseteq \DB$.
  Then
  \begin{align*}
    \dim(A \cup B / A) \leq \dim(B / A \cap B).
  \end{align*}
  Moreover, 
  \begin{align*}
    \dim(A \cup B / A) = \dim(B / A \cap B) - \alpha E,
  \end{align*}
  % where $E$ is the number of edges connecting the vertices of $A \cup B - A$ to the vertices of $A - A \cap B$.
  where $E$ is the number of edges connecting the vertices of $B - A$ to the vertices of $A - B$.
\end{Lemma}

\begin{Lemma} \label{las_min} [See 4.1 in \cite{laskowski}]
  Suppose $A$ is a positive graph with $\ceil{1/\alpha} + 2$ vertices.
  Then for any $\epsilon > 0$ there exists a graph $B$ such that $(A, B)$ is a minimal pair with dimension $\leq \epsilon$.
  Moreover, every vertex in $A$ is connected to a vertex in $B - A$.
\end{Lemma}

\begin{Lemma} \label{las_str} [See 4.4 in \cite{laskowski}]
  Suppose we have $A \subset \GG$.
  Then for any integer $S \geq 0$ there exists an embedding $f \colon A \arr \GG$ such that $f(A)$ is $S$-strong in $\GG$.
\end{Lemma}
    
\begin{Lemma} \label{las_closure} [See 3.8 in \cite{laskowski}]
  For all $S > 0$ there exists $M = M(S, \alpha) \in \N$ with the following property.
  Suppose $A \subseteq \GG$.
  Then there exists $B$ with $A \subseteq B \subseteq \GG$ such that $B$ is $S$-strong in $\GG$ and $|B| \leq M|A|$.
\end{Lemma}

We conclude this section by stating a couple of technical lemmas that will be useful in our proofs later.
In these lemmas we work in some ambient graph $\DB$; that is, all the finite graphs that come up are assumed to be subgraphs of $\DB$.

\begin{Lemma} \label{minimal_over_set}
  Let $B$ be a graph and $(A, M)$ be a minimal pair with $A \subseteq B$ and $\dim(M/A) = -\epsilon$.
  Then either $M \subseteq B$ or $\dim(M \cup B/B) < -\epsilon$.
\end{Lemma}

\begin{proof}
  By Lemma \ref{diamond} we have
  \begin{align*}
    \dim(M \cup B/B) \leq \dim(M / M \cap B),
  \end{align*}
  and as $A \subseteq M \cap B \subseteq M$ we get
  \begin{align*}
    \dim (M/A) = \dim(M / M \cap B) + \dim(M \cap B / A).
  \end{align*}
  In addition we are given $\dim (M/A) = -\epsilon$.
  If $M \not\subseteq B$ then $A \subseteq M \cap B \subsetneq M$ and by minimality $\dim(M \cap B / A) > 0$.
  Combining the inequalities above we obtain the desired result:
  \begin{align*}
    \dim(M \cup B/B) \leq \dim(M / M \cap B) = \dim (M/A) - \dim(M \cap B / A) < -\epsilon.
  \end{align*}
\end{proof}

\begin{Lemma}	\label{chain_lemma}
  Let $B$ be a graph and $\agl{M_i}_{0 \leq i \leq n}$ be a minimal chain with dimensions
  \begin{align*}
    \dim(M_{i+1}/M_i) = -\epsilon_i
  \end{align*}
  and $M_0 \subseteq B$.
  Let $\epsilon = \min_{0 \leq i \leq n} \epsilon_i$.
  Then either $M_n \subseteq B$ or $\dim((M_n \cup B)/B) < -\epsilon$.
\end{Lemma}

\begin{proof}
  Let ${\mybar M}_i = M_i \cup B$. Then:
  \begin{align*}
    \dim({\mybar M}_n/B) = \dim({\mybar M}_n/{\mybar M}_{n-1}) + \ldots + \dim({\mybar M}_2/{\mybar M}_1) + \dim({\mybar M}_1/B).
  \end{align*}
  Either $M_n \subseteq B$ or at least one of the summands above is nonzero.
  Apply the previous lemma.
\end{proof}

\begin{Lemma} \label{minimal_subset}
  Let $(A, M)$ be a minimal pair with dimension $\epsilon$ and let $B \subseteq M$.
  Then
  \begin{align*}
    \dim B / (A \cap B) \geq -\epsilon.    
  \end{align*}
  Moreover if $B \cup A \neq M$ then $\dim B / (A \cap B) \geq 0$.
\end{Lemma}

\begin{proof}
  We have $\dim (B \cup A / A) \leq \dim (B / A \cap B)$ by Lemma \ref{diamond}.
  Note that $A \subseteq B \cup A \subseteq M$.
  If $B \cup A \neq M$ then we have $\dim (B \cup A / A) \geq 0$ by minimality.
  If $B \cup A = M$ then we have $\dim (B \cup A / A) = -\epsilon$.
  % Moreover, minimality implies that it is positive if $B \cup A \neq M$.
\end{proof}

\begin{Lemma} \label{chain_intersect}
  Let  $\agl{M_i}_{0 \leq i \leq n}$ be  a minimal chain with dimensions
  \begin{align*}
    \dim(M_i/M_{i-1}) = -\epsilon_i.
  \end{align*}
  Let
  \begin{align*}
    \epsilon = \sum_{i = 1}^{n}\epsilon_i,  
  \end{align*}
  and let $B \subseteq M_n$.
  Then $\dim (B / M_0 \cap B) \geq -\epsilon$.
\end{Lemma}

\begin{proof}
  Let $B_i = B \cap M_i$.
  We have $\dim (B_{i+1}/B_i) \geq \dim (M_{i+1}/M_i)$ by the previous lemma.
  Thus
  \begin{align*}
    \dim (B / M_0 \cap B) = \dim (B_n / B_0) = \sum_{i = 1}^n \dim (B_{i+1}/B_i) \geq -\epsilon.
  \end{align*}
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Lower bound}
\begin{Definition} \label{def_basic}
  Suppose $\phi_{A,B}(x, y)$ is a basic formula.
  Define $X$ to be the graph on the vertices $x$ with edges defined by $\phi$
  (equivalently it is a subgraph of $A$ induced by the vertices $x$).
  Similarly define $Y$.
  Note that $X$, $Y$ are positive as $A$ is positive.
  Additionally, let $Y'$ be a subgraph of $Y$ induced by vertices of $Y$ that are connected to $B - (X \cup Y)$.
\end{Definition}

In this section we restrict our attention to the following family of basic formulas $\phi(x,y)$:
\begin{itemize}
\item All formulas have $Y' = Y$.% (see Definition \ref{def_basic}).
\item All formulas define no edges between $X$ and $Y$.
\item The minimal chain of $\phi(x,y)$ consists of one step, that is we only have one minimal extension as opposed to a chain of minimal extensions.
\item The dimension of that minimal extension is smaller than $\alpha$.
\end{itemize}

We obtain a lower bound for the formulas that are boolean combinations of basic formulas of this type written in disjunctive-normal form.
First, define $\epsilon_L(\phi)$.

\begin{Definition} \ 
  \begin{itemize}
  \item For a basic formula $\phi = \phi_{M_0, M_1}(x, y)$ let $\epsilon(\phi) = -\dim \paren{M_1/M_0}$.
  \item (Negation)
    If $\phi$ is a basic formula, then define
    \begin{align*}
      \epsilon_L(\neg \phi) &= \epsilon_L(\phi).
    \end{align*}
  \item (Conjunction)
    Take a finite collection of formulas $\phi_i(x, y)$ where each $\phi_i$ is a positive or a negative basic formula
    and $\phi = \bigwedge_i\phi_i$.
    If both positive and negative formulas are present then $\epsilon_L(\phi) = \infty$.
    We don't have a lower bound for that case.
    If different formulas define $X$ or $Y$ differently then let $\epsilon_L(\phi) = \infty$.
    In the case of conflicting definitions, the formula would have no realizations.
    Otherwise, let
    \begin{align*}
      \epsilon_L\paren{\bigwedge_i \phi_i} &= \sum_i \epsilon_L(\phi_i).
    \end{align*}
  \item  (Disjunction)
    Take a collection of formulas $\psi_i$ with each formula a conjunction as above.
    Also assume that all the basic formulas that appear agree on $X$ and $Y$.
    Then let
    \begin{align*}
      \epsilon_L\paren{\bigvee \psi_i} &= \min \epsilon_L(\psi_i).
    \end{align*}
  \end{itemize}
\end{Definition}

\begin{Theorem} \label{main_lower}
  For a formula $\psi$ as above we have
  \begin{align*}
    \vc (\psi) \geq \floor{\frac{Y(\psi)}{\epsilon_L(\psi)}},
  \end{align*}
  where $Y(\psi) = \dim(Y)$ (well-defined, as all basic components agree on $Y$).
\end{Theorem}
\begin{proof}
  First, work with a formula that is a conjunction of positive basic formulas $\psi = \bigwedge_{i \in I} \phi_i$.
  Then as we have defined above
  \begin{align*}
    \epsilon_L(\psi) = \sum_{i \in I} \epsilon_L(\phi_i).
  \end{align*}
  If $W_i$ is a witness of $\phi_i$, let $S_i = |W_i|$.
  Let $n_1$ be the largest natural number such that
  \begin{align*}
    n_1 \epsilon_L(\psi) < Y(\psi).
  \end{align*}
  Let $\epsilon'$ be the smallest value among $\epsilon_L(\phi_i)$ corresponding to the formula $\phi'$.
  Let $n_2$ be the largest natural number such that
  \begin{align*}
    n_1 \epsilon_L(\psi) + n_2 \epsilon' < Y(\psi).
  \end{align*}

  Fix some $N > n_1 + n_2$.
  Let $J$ be the set of first $N$ natural numbers. 
  Let $\curly{a_j}_{j \in J}$ be a pairwise disjoint collection of graphs, where each $a_i$ is isomorphic to $X$.
  Let $A = \bigcup_{1 \leq j \leq N} a_j$.
  Let 
  \begin{align*}
    S = |Y| + (n_1 + n_2 + 1) \sum_{i \in I} S_i.
  \end{align*}

  By Lemma \ref{las_str} the graph $A$ can be embedded into $\GG$ as an $S$-strong graph. 
  Abusing notation, we identify $A$ with this embedding.
  Thus we have $A \subseteq \GG$, $S$-strong. 

  Let $J_1, J_2$ be disjoint subsets of $J$, of sizes $n_1, n_2$ respectively.
  Let $b$ be a graph isomorphic to $Y$.
  For each $i \in I, j \in J_1$ let $W_{ij}$ be a witness of $\phi_i(a_j, b)$.
  (Note that then $(a_j \cup b, W_{ij})$ is a minimal pair. Also note that we are not assuming yet that $W_{ij} \subset \GG$.)
  For each $j \in J_1$ let $W_j$ be a union of $\curly{W_{ij}}_{i \in I}$ disjoint over $a_j \cup b$.
  For each $j \in J_2$ let $W_{j}$ be a witness of $\phi'(a_j, b)$.
  Let $W'$ be a union of $\curly{W_j}_{j \in J_1 \cup J_2}$ disjoint over $b$.
  Let $W$ be a union of $W'$ and $A$ disjoint over $\curly{a_j}_{j \in J_1 \cup J_2}$.
  \begin{Lemma} \label{ALEQW}
    We have $A \leq W$.
  \end{Lemma}
  \begin{proof}
    Consider some $A \subsetneq B \subseteq W$.
    We need to show $\dim (B/A) > 0$.
    Let $\BA = A \cup b$.
    We have
    \begin{align*}
      \dim(B/A) = \dim(B/ B \cap \BA) + \dim(B \cap \BA / A).
    \end{align*}
    Let $B_{ij} = B \cap W_{ij}$.
    Let $B_{j} = B \cap W_{j}$.
    To unify indices, relabel all the graphs above as $\curly{B_k}_{k \in K}$ for some index set $K$.
    By the construction of $W$ we have
    \begin{align*}
      \dim(B/ B \cap \BA) = \sum_{k \in K} \dim(B_k/ B_k \cap \BA).
    \end{align*}
    Fix $k$.
    We have $B_k \subseteq W_k$, where $W_k$ is a minimal extension of $M^k_0 = a \cup b$ for some $a \in A$.
    Let $\epsilon_k$ be the dimension of this minimal extension.
    We have $\dim(B_k / B_k \cap \BA) = \dim(B_k / a \cup (B \cap b))$.

    Case 1: $B \cap b = b$.
    Then $M_0^k \subseteq B_k \subseteq W_k$ and
    \begin{align*}
      \dim(B_k / a \cup (B \cap b)) = \dim (B_k/M_0^k).
    \end{align*}
    By minimality of $(M_0^k, B_k)$ we have $\dim (B_k/M_0^k) \geq -\epsilon_k$.
    Thus
    \begin{align*}
      \dim(B/ B \cap \BA) \geq - \sum_{k \in K} \epsilon_k = -\paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'}.
    \end{align*}
    In addition
    \begin{align*}
      \dim(B \cap \BA / A) = \dim (b) = Y(\psi).
    \end{align*}
    Combining the two, we get
    \begin{align*}
      \dim(B/A) \geq Y(\psi) - \paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'},
    \end{align*}
    which is positive by the construction of $n_1, n_2$ as needed.
    
    Case 2: $B \cap b \subsetneq b$.
    \begin{Claim} We have $\dim(B_k / B_k \cap \BA) > 0$.
    \end{Claim}
    \begin{proof}
      Recall that
      \begin{align*}
        \dim(B_k / B_k \cap \BA) = \dim(B_k / a \cup (B \cap b)).
      \end{align*}
      First, suppose that $B_k \cup M_0^k \neq W_k$.
      Then by Lemma \ref{minimal_subset} we get the required inequality.
      Thus we may assume that $B_k \cup M_0^k = W_k$.
      By Lemma \ref{diamond} we have
      \begin{align*}
        \dim(B_k \cup M_0^k / M_0^k) = \dim(B_k / B_k \cap M_0^k) - \alpha E,
      \end{align*}
      where $E$ is the number of edges connecting the vertices of
      $B_k - M_0^k = B_k \cup M_0^k - M_0^k$ to the vertices of $M_0^k - B_k = M_0^k - B_k \cap M_0^k$.
      Noting that $B_k \cup M_0^k = W_k$, $\dim{W_k / M_0^k} = -\epsilon_k$, and $B_k \cap M_0^k = a \cup (B \cap b)$
      we may rewrite the equality above as
      \begin{align*}
        \dim(B_k / a \cup (B \cap b)) = \alpha E - \epsilon,
      \end{align*}
      and $E$ is the number of edges connecting the vertices of $W_k - M_0^k$ to the vertices of $M_0^k - a \cup (B \cap b)$.
      As $Y = Y'$ and $B \cap b \subsetneq b$ we must have $E \geq 1$.
      But then as $\alpha > \epsilon$ we have $\dim(B_k / a \cup (B \cap b)) > 0$ as needed.
    \end{proof}
    \textit{(Continuing the proof of Lemma \ref{ALEQW})}
    Now, recall that
    \begin{align*}
      \dim(B/A) = \dim(B \cap \BA / A) + \sum_{k \in K} \dim(B_k/ B_k \cap \BA).
    \end{align*}
    By the claim above, each of $\dim(B_k/ B_k \cap \BA) > 0$, thus
    \begin{align*}
      \dim(B/A) > \dim(B \cap \BA / A).
    \end{align*}
    In addition,
    \begin{align*}
      \dim(B \cap \BA / A) = \dim (B \cap b) \geq 0,
    \end{align*}
    as $b$ is positive.
    Thus $\dim (B/A) > 0$ as needed.
  \end{proof}

  As $A \leq W$ and $A \subseteq \GG$, we can embed $W$ into $\GG$ over $A$.
  Abusing notation again, we identify $W$ with its embedding $A \leq W \subseteq \GG$.
  In particular, now we have $b \in \GG$.
  Also note that
  \begin{align*}
    \dim(W/A) &= Y(\psi) - \paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'}, \\
    |W| - |A| &\leq |b| + (n_1 + n_2) \sum_{i \in I} S_i.
  \end{align*}

  \begin{Lemma} We have
    \begin{align*}
      \curly{a_j}_{j \in J_1} \subseteq \psi(A, b) \subseteq \curly{a_j}_{j \in J_1 \cup J_2}.
    \end{align*}
  \end{Lemma}
  \begin{proof}
    First inclusion $\curly{a_j}_{j \in J_1} \subseteq \psi(A, b)$ is immediate from the construction of $W$,
    as $W_{ij}$ witnesses that $\phi_i(a_j, b)$ holds.
    For the second inclusion, suppose that there is $a \in A - \curly{a_j}_{j \in J_1 \cup J_2}$ such that $\psi(a,b)$ holds.
    Let $W' \subseteq \GG$ be a witness of $\phi_1(a,b)$.
    First, note that the case $W' \subseteq W$ is impossible
    as there are no edges between $a$ and $W - a$, but there are edges between $a$ and $W' - a$.
    Thus assume $W' \not\subseteq W$.
    As $(a \cup b, W')$ is a minimal pair, by Lemma \ref{minimal_over_set} we have $\dim (W' \cup W / W) < -\epsilon_1$.
    Therefore
    \begin{align*}
      \dim(W' \cup W / A) = \dim (W' \cup W / W) + \dim(W/A) < Y(\psi) - \paren{n_1 \epsilon_L(\psi) + n_2 \epsilon'} - \epsilon_1,
    \end{align*}
    which is negative by the construction of $n_1, n_2$.
    Thus $A \not\leq W \cup W'$, as then it would have a positive dimension.
    Additionally,
    \begin{align*}
      |W' \cup W| - |A| \leq |W' - W| + |W| - |A| \leq S_1 + |b| + (n_1 + n_2) \sum_{i \in I} S_i \leq S,
    \end{align*}
    but then this is a contradiction as $A$ is $S$-strong but $A \not\leq W \cup W'$.
  \end{proof}

  In the construction of $W$ we could have chosen the index sets $J_1, J_2$ arbitrarily.
  In particular, suppose we let $J_2$ be the last $n_2$ indices of $J$ and
  $J_1$ an arbitrary $n_1$-element subset of the first $N - n_2$ elements of $J$.
  Each of those choices would then yield a different trace $\psi(A, b)$ by the lemma above.
  Thus $\psi(A, M^{|y|}) \geq {N - n_2 \choose n_1}$ and therefore $\vc(\psi) \geq n_1$.
  By the definition of $n_1$ we have $n_1 = \floor{\frac{Y(\psi)}{\epsilon_L(\psi)}}$, so this proves the theorem for $\psi$.
 
  Now consider a formula which is a conjunction of negative basic formulas $\psi = \bigwedge_{i \in I} \neg \phi_i$.
  Let $\bar \psi = \bigwedge_{i \in I} \phi_i$.
  Do the construction above for $\bar \psi$ and suppose its trace is $X \subseteq A$ for some $b$.
  Then $A - X$ is the trace $\psi(A, b)$.
  Therefore we get as many traces as above and thus the same bound.
  
  Finally, consider a formula $\theta = \bigvee_{k \in K} \psi_k$
  which is a disjunction of the formulas considered in the previous paragraph.
  Choose the one with the smallest $\epsilon_L$, say $\psi_k$, and repeat the construction above for $\psi_k$.
  Any trace for $\psi_k$ is automatically a trace for $\theta$, so we get as many traces as above, and thus the same bound.
\end{proof}

\begin{Corollary}
  The VC-density function is infinite in the theory of Shelah-Spencer graphs:
  \begin{align*}
    \vc^{S_\alpha}(n) = \infty.
  \end{align*}
\end{Corollary}

\begin{proof}
  Let $A$ be a graph consisting of $\ceil{1/\alpha} + 2$ disconnected vertices.
  Fix $\epsilon > 0$.
  By Lemma \ref{las_min}, there exists $B$ such that $(A, B)$ is a minimal pair with dimension $\leq \epsilon$ and
  every vertex in $A$ is connected to a vertex in $B - A$.
  Consider a basic formula $\psi_{A, B}(x, y)$ where $|x| = \ceil{1/\alpha} + 1$ and $|y| = 1$.
  Then by the theorem above we have $\vc^{S_\alpha}(1) \geq \vc (\psi_{A,B}) \geq \floor{\frac{1}{\epsilon}}$.
  As $\epsilon$ was arbitrary, we can make this number as large as we want, giving $\vc^{S_\alpha}(1) = \infty$.
  By Lemma \ref{vcone} we then have $\vc^{S_\alpha}(n) = \infty$ as needed.
\end{proof}

\begin{Corollary}
  The theory of Shelah-Spencer graphs doesn't have finite dp-rank.
  In particular it is not dp-minimal.
\end{Corollary}

\begin{proof}
  Suppose that the ambient model $\GG$ is $\aleph_1$-saturated.
  It suffices to show that $\GG$ doesn't have finite dp-rank.
  We would like to modify the proof of Theorem \ref{main_lower} to make $A$ an infinite $\emptyset$-indiscernible sequence.
  (Note that as $S_\alpha$ is stable, all indiscernible sequences are totally indiscernible.)
  In the proof we can construct $S$-strong sets $A = \curly{a_j}_{j \in J}$ of arbitrary finite size.
  Moreover, for every $J' \subseteq J$, the set $A = \curly{a_j}_{j \in J'}$ is still $S$-strong.
  Thus by Lemma \ref{make_ind} we can find an infinite $\emptyset$-indiscernible sequence $A = \curly{a_j}_{j \in \N}$ in $\GG$ that is $S$-strong.
  Repeating the construction of the corollary above,
  we can obtain a formula with an arbitrarily large VC-density over this indiscernible sequence $A$.
  By Definition \ref{def_dp} this means that $\GG$ doesn't have finite dp-rank.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Upper bound}
Let $\phi(x,y)$ be a basic formula associated to a minimal chain  $\agl{M_i}_{0 \leq i \leq n}$ with dimensions
\begin{align*}
  \dim(M_{i+1}/M_i) = -\epsilon_i.  
\end{align*}
Define
\begin{align*}
  \epsilon(\phi) &= \min \curly{\epsilon_i}_{0 \leq i \leq n_\phi}\\
  K(\phi) &= |M_{n}|.
\end{align*}
Now consider a finite collection of basic formulas
\begin{align*}
  \Phi = \Phi( x, y) = \curly{\phi_i( x,  y)}_{i\in I}.
\end{align*}
Define
\begin{align*}
  K(\Phi) &= \max \curly{K(\phi_i)}_{i \in I}, \\
  \epsilon(\Phi) &= \min \curly{\epsilon(\phi_i)}_{i \in I} \cup \curly{\alpha}.
\end{align*}
\begin{Theorem} \label{upper}
  If $\phi$ is a boolean combination of formulas from $\Phi$, then
  \begin{align*}
    \vc(\phi) \leq \DPHI.    
  \end{align*}
\end{Theorem}
We first reduce Theorem \ref{upper} to a combinatorial statement (Theorem \ref{main_bound} below), the proof of which
takes up the rest of this section.

Let
\begin{align*}
  S = \left\lceil{\paren{\frac{|y|}{\epsilon(\phi)} + 1} K(\phi)}\right\rceil.
\end{align*}
Fix a finite parameter set $A_0 \subseteq \GG^{|x|}$ with $|A_0| = N_0$.
We would like to bound $\abs{\phi(A_0, \GGY)}$ in terms of $\Phi$ and $N_0$.
Let $A_1 \subseteq \GG$ consist of the components of the tuples of $A_0$ (so $A_0 \subset A_1^{|x|}$).
Then $|A_1| \leq |x| N_0$.
Using Lemma \ref{las_closure} let $A$ be a graph $A_1 \subseteq A \subseteq \GG$, $S$-strong in $\GG$.
Let $N = |A|$.
Then we have $N \leq |x| N_0 M$ (where $M = M(S, \alpha)$ is the constant from Lemma \ref{las_closure}).
As $A_0 \subseteq \AX$ we have
\begin{align*}
  \abs{\phi(A_0, \GGY)} \leq \abs{\phi(\AX, \GGY)}.
\end{align*}
Therefore it suffices to bound $\abs{\phi(\AX, \GGY)}$ uniformly in $\Phi, |A|$.

\begin{Definition}
  For $A \subseteq \GG^{|x|}, B \subseteq \GG^{|y|}, b \in \GG^{|y|}$ define
  \begin{align*}
    &\Phi(A, b) = \curly{(a, i) \in A \times I \mid \GG \models \phi_i(a, b) } \subseteq A \times I, \\
    &\Phi(A, B) = \curly{\Phi(A, b) \mid b \in B } \subseteq \PP(A \times I).
  \end{align*}  
\end{Definition}

\begin{Lemma}
  For $A \subseteq \GG^{|x|}, B \subseteq \GG^{|y|}$
  if $\phi$ is a boolean combination of formulas from $\Phi$ then
    $\abs{\phi(A, B)} \leq \abs{\Phi(A, B)}$.
\end{Lemma}
\begin{proof}
  Clear, as for all $a \in A, b \in B$ the set
  \begin{align*}
    \Phi(a, b) = \curly{i \in I \mid \GG \models \phi_i(a, b)}
  \end{align*}
  determines the truth value of $\phi(a,b)$.
\end{proof}

Thus it suffices to bound  $\abs{\Phi(\AX, \GGY)}$ in terms of $\Phi, |A|$.
% Below we fix $A \subset \GG$.

\begin{Definition} \label{def_e}\ 
  \begin{itemize}
  \item For all $i \in I, a \in \AX, b \in \GGY$ if $\phi_i(a, b)$ holds, fix $W^i_{a,b} \subseteq \GG$, a witness of $\phi_i(a, b)$.
  \item For $b \in \GGY$ let 
    \begin{align*}
      W_b = \bigcup \curly{W^i_{a,b} \mid a \in \AX, i \in I, \GG \models \phi_i(a,b)}.
    \end{align*}
  \item Suppose $A, B$ are subgraphs of $\GG$ such that $v(A), v(B)$ are disjoint.
    Then define $\E(A, B)$ to be the number of edges between the vertices in $v(A)$ and the vertices in $v(B)$.
  \item For $C, B \subset \GG$ define the \defn{boundary} of $C$ over $B$
    \begin{align*}
      \partial(C, B) = \curly{b \in B \mid \E(b, C - B) \neq 0} \subset B.
    \end{align*}
    % (see Definition \ref{def_e} for $\E$).
  \item For $b \in \GGY$ let $\partial_b = \partial(W_b, A) \subset A$.
  \item For $b \in \GGY$ let ${\mybar W}_b = (W_b - A) \cup \ppp_b$.
  \item For $b_1, b_2 \in \GGY$ we say that $b_1 \sim b_2$ if $\ppp_{b_1} = \ppp_{b_2}$,
    $b_1 \cap A = b_2 \cap A$,
    and there exists a graph isomorphism from ${\mybar W}_{b_1} \cup b_1$ to ${\mybar W}_{b_2} \cup b_2$
    that fixes $\ppp_{b_1}$ and
    maps $b_1$ to $b_2$.
    One easily checks that this defines an equivalence relation.
  % \item For $b \in \GGY$ define $\II_b$ to be the $\sim$-equivalence class of $b$.
  \end{itemize}
\end{Definition}

\begin{Lemma} \label {bound_trace}
  For $b_1, b_2 \in \GGY$ if $b_1 \sim b_2$ then $\Phi(\AX, b_1) = \Phi(\AX, b_2)$.
\end{Lemma}

\begin{proof}
  Fix a graph isomorphism $\bar f \colon {\mybar W}_{b_1} \cup b_1 \arr {\mybar W}_{b_2} \cup b_2$.
  Extend it to an isomorphism $f \colon W_{b_1} \cup A \arr W_{b_2} \cup A$ by making it an identity map on the new vertices.
  Suppose $\GG \models \phi_i(a, b_1)$ for some $a \in \AX$.
  Then $f(W^i_{a, b_1})$ is a witness of $\phi_i(a, b_2)$ (though not necessarily equal to $W^i_{a, b_2}$)
  and thus $\GG \models \phi_i(a, b_2)$.
  As $a$ was arbitrary, this proves the equality of the traces.
\end{proof}

Thus to bound the number of traces it is sufficient to bound the number of $\sim$-equivalence classes.

\begin{Theorem} \label{main_bound}
  Suppose we have $b \in \GGY$.
  Let $Y = \abs{b - A}$.
  Then
  \begin{align*}
    |\partial_b| &\leq \floor{Y \DOPHI },\\ 
    |{\mybar W}_b| &\leq \floor{3 Y \DOPHI}.
  \end{align*}
\end{Theorem}

From this theorem we get the desired result:
\begin{Corollary} (Theorem \ref{upper})
  If $\phi$ is a boolean combination of formulas from $\Phi$, then $\vc(\phi) \leq \DPHI$.
\end{Corollary}

\begin{proof} [Proof of Theorem \ref{upper} (based on Theorem \ref{main_bound})]
  We count possible equivalence classes of $\sim$.
  This amounts to bounding the possibilities for $\partial_b$, $b \cap A$, and the number of isomorphism classes of $W_b$.
  Fix $b \in \GGY$ and let $Y = \abs{b - A}$.
  Let
  \begin{align*}
    D = \floor{Y \DOPHI}, \\ 
    D' = \floor{3Y \DOPHI}, \\
    D'' = \DPHI.
  \end{align*}
  By the first part of Theorem \ref{main_bound} there are $N \choose D$ choices for the boundary $\partial_b$.
  By the second part of Theorem \ref{main_bound} there are at most $D'$ vertices in ${\mybar W}_b$.
  Thus to determine the graph ${\mybar W}_b$ we need to choose how many vertices it has and then decide where edges go.
  This amounts to at most $D' 2^{(D')^2}$ choices.
  Additionally there are $N \choose |y| - Y$ choices for $b \cap A$.
  In total this gives us at most
  \begin{align*}
    {N \choose D} \cdot {N \choose |y| - Y} \cdot D' 2^{(D')^2} = \OO{N^{D + |y| - Y}}
  \end{align*}
  choices.
  By Lemma \ref{bound_trace} we have $\abs{\Phi(\AX, \GGY)} = \OO{N^{D + |y| - Y}}$.
  As $\DOPHI \geq 1$ we have
  \begin{align*}
    {D + |y| - Y} = {\floor{Y \DOPHI} + |y| - Y} \leq {\floor{|y| \DOPHI}} = D''.
  \end{align*}
  Thus 
  \begin{align*}
    \abs{\Phi(\AX, \GGY)} = \OO{N^{D + |y| - Y}} = \OO{N^{D''}}.
  \end{align*}
  Recall that 
  \begin{align*}
    \abs{\phi(A_0, \GGY)} \leq \abs{\Phi(\AX, \GGY)}.    
  \end{align*}
  Therefore we have
  \begin{align*}
    \abs{\phi(A_0, \GGY)} &= \OO{N^{D''}} = \OO{\paren{|x| N_0 M}^{D''}} = \\
    &= \OO{\paren{|x| M}^{D''} N_0^{D''}} = \OO{N_0^{D''}}.
  \end{align*}
  As $A_0$ was arbitrary, this shows that $\vc(\phi) \leq D'' = \DPHI$ as needed.
  (Note that throughout this proof we are using the fact that quantities $K(\Phi), \epsilon(\Phi), M$ are completely determined by $\Phi$,
  thus independent from $A_0$.)
\end{proof}

\begin{proof} [Proof of Theorem \ref{main_bound}]
  The graph $W_b$ is a union of witnesses of the form $W_{a,b}$ for some $a \in \AX, b \in \GGY$.
  Enumerate all of them as $\curly{W_j}_{1 \leq j \leq J}$.
  Define $M_j = \bigcup_{k=1}^j W_{k}$ for $1 \leq j \leq J$ and let $M_0 = b, M_{-1} = \emptyset$.
  Let $\BA = A \cup b$.
  \begin{Definition}
    For $0 \leq j \leq J$:
    \begin{itemize}
    \item Let $v_j = 1$ if new vertices are added to $M_j$ outside of $\BA$, that is if
      $M_j - \BA \neq M_{j-1} - B$,
      and let it be $0$ otherwise.
    \item Let %$E_j = \curly{a \in A - W_j \mid  \E(a, M_j - A) \neq \emptyset}$.
      $E_j = \partial(A - W_j, M_j - A)$.
    \item Let
      \begin{align*}
        m_j = \sum_{k = 0}^j (v_j + |E_j|).
      \end{align*}
    \end{itemize}
  \end{Definition}

  \begin{Lemma} \label{ubd_lemma}
    For $0 \leq j \leq J$ we have
    \begin{align*}
      |\partial(M_j, A)| \leq |E_0| + m_j K(\Phi).
    \end{align*}
  \end{Lemma}

  \begin{proof} %\textit{(of Lemma \ref{ub_lemma})}
    Proceed by induction on $j = 0, \ldots, J$. The base case $j = 0$ is clear.
    For the inductive step suppose that
    \begin{align*}
      |\partial(M_{j-1}, A)| \leq m_{j-1}  K(\Phi)
    \end{align*}
    holds.
    Let
    \begin{align*}
      \delta_1 &= \partial(M_j, A) - \partial(M_{j-1}, A) = \\
               &=\curly{a \in A \mid  \E(a, M_j - A) \neq 0 \text{ and } \E(a, M_{j-1} - A) = 0}.
    \end{align*}
    If $M_j - A = M_{j-1} - A$ then $\delta_1 = \emptyset$ and we are done as $m_j$ is increasing.
    Suppose not.
    We have $|\delta_1| = |\delta_1 \cap W_j| + |\delta_1 - W_j|$, and
    \begin{align*}
      \delta_1 - W_j = \curly{a \in A - W_j \mid \E(a, M_j - A) \neq 0 \text{ and } \E(a, M_{j-1} - A) = 0}.
    \end{align*}
    But then it's clear that $\delta_1 - W_j \subseteq E_j$ as
    \begin{align*}
      &W_j - M_{j-1} - A \subseteq M_j - A, \\
      &(W_j - M_{j-1} - A) \cap (M_{j-1} - A) = \emptyset.
    \end{align*}
    As $b \in M_{j-1}$ and $M_j - A \neq M_{j-1} - A$, then $M_j - \BA \neq M_{j-1} - \BA$, and thus $v_j = 1$. 
    Therefore we have
    \begin{align*}
      |\delta_1| &= |\delta_1 \cap W_j| + |\delta_1 - W_j| \leq |W_j| + |E_j| \leq \\
      &\leq K(\Phi) + |E_j|
      \leq (v_j + |E_j|) K(\Phi)  \leq (m_j - m_{j-1}) K(\Phi),
    \end{align*}
    as needed.
  \end{proof}

  \begin{Lemma} \label{ub_lemma}
    For $0 \leq j \leq J$ we have
    \begin{align*}
      |M_j - \BA| \leq \paren{\sum_{k=0}^j v_{k}} K(\Phi).
    \end{align*}
  \end{Lemma}

  \begin{proof} %\textit{(of Lemma \ref{ub_lemma})}
    Proceed by induction on $j = 0, \ldots, J$. The base case $j = 0$ is clear.
    For the inductive step suppose that
    \begin{align*}
      |M_{j-1} - \BA| \leq \paren{\sum_{k=0}^{j-1} v_{k}} K(\Phi)
    \end{align*}
    holds.
    If $M_j - \BA = M_{j-1} - \BA$ then the inequality is immediate as $v_j \geq 0$.
    Therefore assume this is not the case.
    Then $v_j = 1$ and $|M_j - A| - |M_{j-1} - A| \leq |W_j| \leq v_j K(\Phi)$ so we get the required inequality.
  \end{proof}
  
  \begin{Lemma} \label{ubdim_lemma}
    For $0 \leq j \leq J$ we have
    \begin{align*}
      \dim(M_j \cup \BA / \BA) \leq -m_j  \epsilon(\Phi),
    \end{align*}
  \end{Lemma}
  \begin{proof}
    Proceed by induction on $j = 0, \ldots, J$. The base case $j = 0$ is clear.
    For the inductive step suppose that
    \begin{align*}
      \dim(M_{j-1} \cup \BA / \BA) \leq  - m_{j-1}  \epsilon(\Phi)
    \end{align*}
    holds.
    We have
    \begin{align*}
      \dim(M_j \cup \BA / \BA) &= \dim(M_j \cup \BA / M_{j-1} \cup \BA) + \dim(M_{j-1} \cup \BA / \BA) \leq \\
      &\leq \dim(M_j \cup \BA / M_{j-1} \cup \BA) - m_{j-1}  \epsilon(\Phi).
    \end{align*}
    Let $\BM = M_{j-1} \cup \BA$.
    By Lemma \ref{diamond} we have
    \begin{align*}
      \dim(M_j \cup \BA / M_{j-1} \cup \BA) = \dim(W_j \cup \BM / \BM) = \dim(W_j / W_j \cap \BM) - E \alpha
    \end{align*}
    where $E$ is the number of edges connecting the vertices of $\BM - W_j$ to the vertices of $W_j - \BM$.
    Recall that       $E_j = \partial(A - W_j, M_j - A)$.
    We have $A - W_j \subseteq \BM - W_j$ (as $A \subseteq \BM$) and $W_j - M_{j-1} - A = W_j - \BM$ (as for $j > 1$, we have $b \subseteq M_{j-1}$).
    Thus $|E_j| \leq E$, and we get 
    \begin{align*}
      \dim(M_j \cup \BA / M_{j-1} \cup \BA) \leq \dim(W_j / W_j \cap \BM) - |E_j| \alpha.
    \end{align*}
    If $W_j \subseteq \BM$ then $\dim(W_j / W_j \cap \BM) = 0$.
    If not, then by Lemma \ref{chain_lemma} we have $\dim(W_j / W_j \cap \BM) \leq - \epsilon(\Phi)$.
    Either way, we have $\dim(W_j / W_j \cap \BM) \leq - v_j \epsilon(\Phi)$.
    Using this and the fact that $\epsilon(\Phi) \leq \alpha$, we obtain
    \begin{align*}
      \dim(M_j \cup \BA / M_{j-1} \cup \BA) \leq - v_j \epsilon(\Phi) - |E_j| \epsilon(\Phi) = -(m_j - m_{j-1})\epsilon(\Phi).
    \end{align*}
    Finally,
    \begin{align*}
      \dim(M_j \cup \BA / \BA) &\leq \dim(M_j \cup \BA / M_{j-1} \cup \BA) - m_{j-1}  \epsilon(\Phi) \leq \\
      &\leq  -(m_j - m_{j-1})\epsilon(\Phi) - m_{j-1}  \epsilon(\Phi) =  - m_j  \epsilon(\Phi),
    \end{align*}
    as needed.
  \end{proof}
  \textit{(Proof of Theorem \ref{main_bound} continued)}
  For any $0 \leq j \leq J$ we have
  \begin{align*}
    \dim(M_j \cup A / A) &= \dim(\BA / A) + \dim(M_j \cup \BA / \BA) \\
    &\leq Y - |E_0|\alpha + \dim(M_j \cup \BA / \BA).
  \end{align*}
  Lemma \ref{ubdim_lemma} gives us
  \begin{align*}
    \dim(M_j \cup \BA / \BA) \leq -m_j  \epsilon(\Phi).
  \end{align*}
  Thus
  \begin{align*}
    \dim(M_j \cup A / A) \leq Y - |E_0| \alpha - m_j  \epsilon(\Phi).
  \end{align*}
  Suppose $j$ is an index such that
  \begin{align*}
    &Y - |E_0| \alpha - m_j  \epsilon(\Phi) \geq 0, \\
    &Y - |E_0| \alpha - m_{j+1}  \epsilon(\Phi) < 0
  \end{align*}
  if one exists.
  Then 
  \begin{align*}
    m_j \leq \frac{Y - |E_0| \alpha}{\epsilon(\Phi)}.
  \end{align*}
  By Lemma \ref{ub_lemma} we have
  \begin{align*}
    \abs{M_{j+1} - A} &\leq \paren{\sum_{k=1}^{j+1} v_{k}} K(\Phi) \leq (m_j + 1) K(\Phi) \leq \\
                     &\leq \paren{\frac{Y - |E_0| \alpha}{\epsilon(\Phi)} + 1} K(\Phi) \leq S.
  \end{align*}
  This is a contradiction, as $A$ is $S$-strong and $\dim(M_{j+1} \cup A / A)$ is negative.
  Thus $Y - |E_0| \alpha - m_j  \epsilon(\Phi) \geq 0$ for all $j \leq J$.
  In particular $Y - |E_0| \alpha - m_J  \epsilon(\Phi) \geq 0$, so $m_J \leq \frac{Y - |E_0| \alpha}{\epsilon(\Phi)}$.
  Noting that $M_J = W_b$, Lemma \ref{ubd_lemma} gives us 
  \begin{align*}
      |\ppp_b| = |\partial(W_b, A)| \leq |E_0| + m_J  K(\Phi) \leq |E_0| + K(\Phi) \frac{Y - |E_0| \alpha}{\epsilon(\Phi)}.
  \end{align*}
  As $K(\Phi) \geq 1$ and $\epsilon(\Phi) \geq \alpha$, we get
  \begin{align*}
      |\ppp_b| \leq K(\Phi) \frac{Y}{\epsilon(\Phi)} = Y \frac{K(\Phi)}{\epsilon(\Phi)}.
  \end{align*}
  As $|\ppp_b|$ is an integer we have $|\ppp_b| \leq \floor{Y \DOPHI}$.
  But this is precisely the first inequality we need to prove.
  For the second inequality, Lemma \ref{ub_lemma} gives us
  \begin{align*}
    \abs{W_b - \BA} &\leq Y + \paren{\sum_{k=0}^J v_{k}} K(\Phi) \leq Y + m_J K(\Phi) \leq \\
    &\leq Y + K(\Phi) \frac{Y}{\epsilon(\Phi)} \leq 2Y \frac{K(\Phi)}{\epsilon(\Phi)}.
  \end{align*}
  As $\abs{W_b - \BA}$ is an integer we have $\abs{W_b - \BA} \leq \floor{2 Y \DOPHI}$.
  Thus we have
  \begin{align*}
      |{\mybar W}_b| \leq \abs{W_b - A} + \abs{\ppp_b} \leq \floor{3 Y \DOPHI},
  \end{align*}
  as needed.
  This ends the proof of Theorem \ref{main_bound}.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Conclusion}
We have computed upper and lower bounds for certain types of formulas in Shelah-Spencer graphs.
The bounds are not tight: in the best case scenario for a basic formula $\phi(x,y)$ defining a minimal extension of
dimension $\epsilon$ we have
\begin{align*}
  \frac{|y|}{\epsilon} \leq \vc(\phi) \leq K \frac{|y|}{\epsilon},
\end{align*}
where $K$ is the number of vertices in this minimal extension.
Thus there is a multiple of $K$ gap between lower and upper bounds.
It is this author's hope that a refinement of the presented techniques can yield better estimates of the VC-density.
One potential way to achieve this goal is to conduct a closer study on
how multiple minimal extensions can intersect without increasing the overall dimension.

One direction for the future work is to ask what these bounds on VC-density can tell about
the structure of large finite random graphs, along the lines of results in \cite{anthony}.

Note that this \chapa doesn't answer the question on whether there can be exotic values for the VC-density of individual formulas,
such as non-integer or irrational values.
A better bound can help address this.
\begin{openq}
  In Shelah-Spencer graphs can a formula have non-integer or irrational VC-density?
\end{openq}
Another observation is that while the VC-density function is infinite
there seems to be a good structural behavior of the VC-density for individual formulas.
This suggests that perhaps the VC-density function is not the best tool to describe the behavior of definable sets in Shelah-Spencer graphs,
and some more refined measure might be required.
One potential way to do this is to separate the formulas based on the values of $K(\phi)$ and $\epsilon(\phi)$.
Once those are bounded, VC-density seems to be well-behaved.
The author hopes to explore this further in his future work.
