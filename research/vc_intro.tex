
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\section{VC-dimension and vc-density}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 



Throughout this section we work with a collection $\F$ of subsets of a set $X$.
We call the pair $(X, \F)$ a \defn{set system}.

\begin{Definition} \ 
  \begin{itemize} 
  \item Given a subset $A$ of $X$, we define the set system $(A, A \cap \F)$
    where $A \cap \F = \curly{A \cap F \mid F\in \F}$.
  \item For $A \subset X$ we say that $\F$ \defn{shatters} $A$ if $A \cap \F = \PP(A)$ (the power set of $A$).
  \end{itemize}    
\end{Definition}  

\begin{Definition}
  We say $(X, \F)$ has \defn{VC-dimension} $n$ if the largest subset of $X$ shattered by $\F$ is of size $n$.
  If $\F$ shatters arbitrarily large subsets of $X$, we say that $(X, \F)$ has infinite VC-dimension.
  We denote the VC-dimension of $(X, \F)$ by $\VC(X, \F)$.
\end{Definition}  

\begin{Note}
  We may drop $X$ from the notation $\VC(X, \F)$, as the VC-dimension doesn't depend on the base set and is determined by $(\bigcup \F, \F)$.
\end{Note}
Set systems of finite VC-dimension tend to have good combinatorial properties,
and we consider set systems with infinite VC-dimension to be poorly behaved.

Another natural combinatorial notion is that of a dual system:
\begin{Definition}
  For $a \in X$ define $X_a = \curly{F \in \F \mid a \in F}$.
  Let $\F^* = \curly{X_a \mid a \in X}$.
  We call $(\F, \F^*)$ the \defn{dual system} of $(X, \F)$.
  The VC-dimension of the dual system of $(X, \F)$ is referred to as the \defn{dual VC-dimension} of $(X, \F)$ and denoted by $\VC^*(\F)$.
  (As before, this notion doesn't depend on $X$.)
\end{Definition}  

\begin{Lemma} [see 2.13b in \cite{ash7}]
  A set system $(X, \F)$ has finite VC-dimension if and only if its dual system has finite VC-dimension.
  More precisely
  \begin{align*}
    \VC^*(\F) \leq 2^{1+\VC(\F)}.
  \end{align*}
\end{Lemma}

For a more refined notion of complexity of $(X, \F)$ we look at the traces of our family on finite sets:
\begin{Definition}
  Define the \defn{shatter function} $\pi_\F \colon \N \arr \N$ of $\F$ and the \defn{dual shatter function} $\pi^*_\F \colon \N \arr \N$ of $\F$ by 
  \begin{align*}
    \pi_\F(n) &= \max \curly{|A \cap \F| \mid A \subset X \text{ and } |A| = n} \\
    \pi^*_\F(n) &= \max \curly{\text{atoms($B$)} \mid B \subset \F, |B| = n}
  \end{align*}
  where atoms($B$) = number of atoms in the boolean algebra of sets generated by $B$.
  Note that the dual shatter function is precisely the shatter function of the dual system: $\pi^*_\F = \pi_{\F^*}$.
\end{Definition}  

A simple upper bound is $\pi_\F(n) \leq 2^n$ (same for the dual).
If the VC-dimension of $\F$ is infinite then clearly $\pi_\F(n) = 2^n$ for all $n$. Conversely we have the following remarkable fact:
\begin{Theorem} [Sauer-Shelah '72, see \cite{sauer}, \cite{shelah}]
  If the set system $(X, \F)$ has finite VC-dimension $d$ then $\pi_\F(n) \leq {n \choose \leq d}$ for all $n$, where
  ${n \choose \leq d} = {n \choose d} + {n \choose d - 1} + \ldots + {n \choose 1}$.    
\end{Theorem}

Thus the systems with a finite VC-dimension are precisely the systems where the shatter function grows polynomially.
Define the vc-density of $\F$ to quantify the growth of the shatter function of $\F$: 
\begin{Definition}
  Define the \defn{vc-density} and \defn{dual vc-density} of $\F$ as
  \begin{align*}
    \vc(\F) &= \limsup_{n \to \infty}\frac{\log \pi_\F(n)}{\log n} \in \R^{\geq 0} \cup \curly{+\infty},\\
    \vc^*(\F) &= \limsup_{n \to \infty}\frac{\log \pi^*_\F(n)}{\log n}\in \R^{\geq 0} \cup \curly{+\infty}.
  \end{align*}
\end{Definition}

Generally speaking a shatter function that is bounded by a polynomial doesn't itself have to be a polynomial.
Proposition 4.12 in \cite{density} gives an example of a shatter function that grows like $n \log n$ (so it has vc-density $1$).

So far the notions that we have defined are purely combinatorial.
We now adapt VC-dimension and vc-density to the model theoretic context.

\begin{Definition}
  Work in a first-order structure $M$.
  Fix a finite collection of formulas $\Phi(x, y)$.

  \begin{itemize}
  \item For $\phi(x, y) \in \LL(M)$ and $b \in M^{|y|}$ let 
    \begin{align*}
      \phi(M^{|x|}, b) = \{a \in M^{|x|} \mid \phi(a, b)\} \subseteq M^{|x|}.
    \end{align*}
  \item Let $\Phi(M^{|x|}, M^{|y|})= \{\phi(M^{|x|}, b) \mid \phi_i \in \Phi, b \in M^{|y|}\} \subseteq \PP(M^{|x|})$.
  \item Let $\F_\Phi = \Phi(M^{|x|}, M^{|y|})$, giving rise to a set system $(M^{|x|}, \F_\Phi)$.
  \item Define the \defn{VC-dimension} $\VC(\Phi)$ of $\Phi$, to be the VC-dimension of $(M^{|x|}, \F_\Phi)$, similarly for the dual.
  \item Define the \defn{vc-density} $\vc(\Phi)$ of $\Phi$, to be the vc-density of $(M^{|x|}, \F_\Phi)$, similarly for the dual.
  \end{itemize}

  We will also refer to the vc-density and VC-dimension of a single formula $\phi$
  viewing it as a one element collection $\Phi = \curly{\phi}$.
\end{Definition}

Counting atoms of a boolean algebra in a model theoretic setting corresponds to counting types,
so it is instructive to rewrite the shatter function in terms of types.

\begin{Definition} 
  \begin{align*}
    \pi^*_\Phi(n) &= \max \curly{\text{number of $\Phi$-types over $B$} \mid B \subset M, |B| = n}
  \end{align*}
  Here a $\Phi$-type over $B$ is a maximal consistent collection of formulas of the form $\phi(x, b)$ or $\neg\phi(x, b)$
  where $\phi \in \Phi$ and $b \in B$.
\end{Definition}

Functions $\pi^*_{\Phi}$ and $\pi^*_{\F_\Phi}$ are not equal, as one fixes the size of boolean algebra and another fixes the size of the parameter set.
However, as the following lemma demonstrates, they both give the same asymptotic definition of dual $\vc$-density.

\begin{Lemma} \label{count_types}
  \begin{align*}
    \vc^*(\Phi) &= \text{degree of polynomial growth of $\pi^*_\Phi(n)$}  = \limsup_{n \to \infty}\frac{\log \pi^*_\Phi(n)}{\log n}
  \end{align*}  
\end{Lemma}

\begin{proof}
  With parameter set of size $n$, we get $|\Phi|n$ elements in the boolean algebra.
  We check that asymptotically it doesn't matter whether we look at growth of boolean algebra of size $n$ or size $|\Phi|n$.
  \begin{align*}
    &\pi^*_{\F_\Phi}\paren{n} \leq \pi^*_\Phi(n) \leq \pi^*_{\F_\Phi}\paren{|\Phi|n} \\
    &\vc^*(\Phi) \leq \limsup_{n \to \infty}\frac{\log \pi^*_\Phi(n)}{\log n} \leq \limsup_{n \to \infty}\frac{\log \pi^*_{\F_\Phi}\paren{|\Phi|n}}{\log n} = \\
    & = \limsup_{n \to \infty}\frac{\log \pi^*_{\F_\Phi}\paren{|\Phi|n}}{\log |\Phi|n} \frac{\log |\Phi|n}{\log n} =
      \limsup_{n \to \infty}\frac{\log \pi^*_{\F_\Phi}\paren{|\Phi|n}}{\log |\Phi|n} \leq \\
    &\leq \limsup_{n \to \infty}\frac{\log \pi^*_{\F_\Phi}\paren{n}}{\log n} = \vc^*(\Phi)
  \end{align*}
\end{proof} 

One can check that the shatter function and hence VC-dimension and vc-density of a formula are elementary notions,
so they only depend on the first-order theory of the structure $M$.

NIP theories are a natural context for studying vc-density.
In fact we can take the following as the definition of NIP:
\begin{Definition}
  Define $\phi$ to be NIP if it has finite VC-dimension in a theory $T$.
  A theory $T$ is NIP if all the formulas in $T$ are NIP.
\end{Definition}

In a general combinatorial context for arbitrary set systems,
vc-density can be any real number in $0 \cup [1, \infty)$ (see \cite{ash8}).
Less is known if we restrict our attention to NIP theories.
Proposition 4.6 in \cite{density} gives examples of formulas that have non-integer rational vc-density in an NIP theory,
however it is open whether one can get an irrational vc-density in this model-theoretic setting.

Instead of working with a theory formula by formula, we can look for a uniform bound for all formulas:
\begin{Definition} \label{vc_fn_def}
  For a given NIP structure $M$, define the \defn{vc-function}
  \begin{align*}
    \vc^M(n) &= \sup \{\vc^*(\phi(x, y)) \mid \phi \in \LL(M), |x| = n\} \\
             &= \sup \{\vc(\phi(x, y)) \mid \phi \in \LL(M), |y| = n\} \in \R^{\geq 0} \cup \curly{+\infty}
  \end{align*}
\end{Definition}

As before this definition is elementary, so it only depends on the theory of $M$.
We omit the superscript $M$ if it is understood from the context.
One can easily check the following bounds:
\begin{Lemma} [Lemma 3.22 in \cite{density}] We have $\vc(1) \geq 1$ and $\vc(n) \geq n\vc(1)$.
  
\end{Lemma}

However, it is not known whether the second inequality can be strict or even whether $\vc(1) < \infty$ implies $\vc(n) < \infty$.
